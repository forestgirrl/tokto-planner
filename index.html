<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>日本F1櫻花自由行 2026</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sakura: {
                            light: '#FFF0F5', 
                            DEFAULT: '#FFB7C5', 
                            dark: '#FF8FAB', 
                        },
                        warm: {
                            bg: '#FDFBF9',
                            text: '#595048',
                            grey: '#E5E0DD'
                        },
                        tag: {
                            eat: '#FF9F43',   // 必吃橘
                            buy: '#9C88FF',   // 必買紫
                            photo: '#0ABDE3', // 必拍藍
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(255, 183, 197, 0.2)',
                        'card': '0 2px 8px rgba(0,0,0,0.05)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #FDFBF9;
            color: #595048;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Layout Structure */
        .content-wrapper {
            margin-top: -30px;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            background-color: #FDFBF9;
            position: relative;
            z-index: 10;
            padding-top: 24px;
            min-height: calc(100vh - 220px);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
        }

        /* Nav Tabs */
        .nav-tabs {
            position: absolute;
            bottom: 40px;
            right: 15px;
            display: flex;
            gap: 12px;
            z-index: 20;
        }
        .nav-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FFB7C5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .nav-item.active {
            background: #FFB7C5;
            color: white;
            transform: translateY(-5px);
            border: 2px solid white;
        }

        /* Timeline Styles */
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 20px;
            bottom: 20px;
            width: 2px;
            background: repeating-linear-gradient(to bottom, #E5E0DD 0, #E5E0DD 6px, transparent 6px, transparent 12px);
            z-index: 0;
        }
        
        /* Card Animations */
        .card-anim { transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-anim:active { transform: scale(0.97); }

        /* Weather Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        .weather-float { animation: float 3s ease-in-out infinite; }
        
        /* Modal Animation */
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<div id="app" class="pb-24">

    <header class="relative w-full h-[260px]">
        <div class="w-full h-full overflow-hidden">
            <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1920&auto=format&fit=crop" alt="Sakura" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"></div>
        </div>

        <div class="absolute top-6 left-6 text-white drop-shadow-md">
            <p class="text-xs font-medium tracking-widest opacity-90 mb-1">JAPAN TRAVEL 2026</p>
            <h1 class="text-3xl font-black tracking-wide">F1 櫻花季</h1>
        </div>

        <div class="nav-tabs">
            <div v-for="tab in tabs" :key="tab.id" 
                 @click="currentTab = tab.id" 
                 :class="['nav-item', currentTab === tab.id ? 'active' : '']">
                <i :class="tab.icon" class="text-lg"></i>
            </div>
        </div>
    </header>

    <main class="content-wrapper px-4">
        
        <div v-if="currentTab === 'itinerary'">
            
            <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-6 pb-2 sticky top-0 bg-warm-bg/95 backdrop-blur-sm z-30 py-2">
                <div v-for="(day, index) in days" :key="index" 
                     @click="selectDay(index)"
                     :class="['flex-shrink-0 flex flex-col items-center justify-center w-[4.5rem] h-20 rounded-2xl transition-all duration-300 border-2 snap-center', 
                              selectedDayIndex === index ? 'bg-sakura text-white border-sakura shadow-soft transform scale-105' : 'bg-white text-warm-text border-transparent shadow-sm']">
                    <span class="text-[10px] font-bold uppercase tracking-wider opacity-80">{{ day.weekday }}</span>
                    <span class="text-2xl font-black">{{ day.dateParts.day }}</span>
                    <span class="text-[10px] opacity-60">{{ day.dateParts.month }}月</span>
                </div>
            </div>

            <div class="relative bg-gradient-to-br from-white to-blue-50 rounded-2xl p-4 mb-8 shadow-card border border-white/50 overflow-hidden">
                <div class="absolute -right-6 -top-6 text-[8rem] opacity-5 text-gray-400">
                    <i :class="weather.icon"></i>
                </div>
                <div class="flex justify-between items-end relative z-10">
                    <div>
                        <div class="flex items-center gap-2 text-gray-500 text-xs font-bold mb-1">
                            <i class="fa-solid fa-location-dot text-sakura"></i>
                            {{ weather.location }}
                        </div>
                        <div class="flex items-center gap-3">
                            <i :class="[weather.icon, weather.color]" class="text-4xl weather-float"></i>
                            <div>
                                <span class="text-3xl font-black text-gray-700">{{ weather.temp }}°</span>
                                <span class="text-xs text-gray-400">體感 {{ weather.feelsLike }}°</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-gray-600">{{ weather.desc }}</div>
                        <div class="text-[10px] text-gray-400 mt-1">降雨機率 10%</div>
                    </div>
                </div>
            </div>

            <div class="relative pb-24 min-h-[300px]">
                
                <div class="timeline-line"></div>

                <div v-if="currentDayItinerary.length === 0" class="text-center py-12 text-gray-300 relative z-10 bg-warm-bg">
                    <i class="fa-solid fa-mug-hot text-4xl mb-3 opacity-50"></i>
                    <p class="text-sm">今天還沒有安排行程，放鬆一下吧</p>
                </div>

                <div id="itinerary-list" class="space-y-6">
                    <div v-for="(item, index) in currentDayItinerary" :key="item.id" class="relative pl-14 group">
                        
                        <div class="absolute left-0 top-0 w-12 flex flex-col items-center z-10">
                            <div class="text-xs font-bold text-gray-400 mb-1 font-mono">{{ item.time || '--:--' }}</div>
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm shadow-md border-2 border-white" :class="getCategoryBg(item.category)">
                                <i :class="getCategoryIcon(item.category)"></i>
                            </div>
                            <div v-if="index < currentDayItinerary.length - 1 || item.travelTime" 
                                 class="mt-2 bg-warm-grey text-[10px] text-gray-500 px-1.5 py-0.5 rounded-md flex flex-col items-center gap-0.5">
                                <span class="h-1 w-[1px] bg-gray-400 mb-0.5"></span>
                                <i :class="getTransportIcon(item.transportType)"></i>
                                <span>{{ item.travelTime || '15m' }}</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-4 shadow-card card-anim border border-transparent hover:border-sakura-light relative overflow-hidden">
                            
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 bg-gray-50 px-2 py-1 rounded-md">
                                    {{ getCategoryLabel(item.category) }}
                                </span>
                                <div class="flex gap-1">
                                    <span v-for="tagKey in item.tags" :key="tagKey" 
                                          :class="['text-[10px] px-2 py-0.5 rounded-full font-bold', getTagStyle(tagKey)]">
                                        {{ getTagLabel(tagKey) }}
                                    </span>
                                </div>
                            </div>

                            <h3 class="font-bold text-lg text-gray-800 leading-tight mb-1">{{ item.name }}</h3>
                            <p v-if="item.desc" class="text-xs text-gray-500 leading-relaxed mb-3">{{ item.desc }}</p>

                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                <div class="text-xs text-gray-400 flex flex-col gap-1">
                                    <span v-if="item.cost"><i class="fa-solid fa-yen-sign w-4 text-center"></i> {{ item.cost }}</span>
                                    <span v-if="item.ticket"><i class="fa-solid fa-ticket w-4 text-center"></i> {{ item.ticket }}</span>
                                </div>

                                <button @click="openGoogleMaps(item.location)" 
                                        class="bg-blue-50 hover:bg-blue-100 text-blue-600 px-4 py-2 rounded-xl text-xs font-bold transition-colors flex items-center gap-2">
                                    <i class="fa-solid fa-location-arrow"></i>
                                    導航
                                </button>
                            </div>

                            <button @click.stop="editItem(item)" class="absolute top-2 right-2 p-2 text-gray-200 hover:text-gray-400">
                                <i class="fa-solid fa-ellipsis"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <button @click="openAddModal" class="fixed bottom-24 right-6 w-14 h-14 bg-gradient-to-tr from-sakura-dark to-sakura text-white rounded-full shadow-lg shadow-pink-200/50 flex items-center justify-center text-2xl z-40 transition-transform hover:scale-110 active:scale-95">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>

        <div v-if="currentTab === 'map'" class="flex flex-col items-center justify-center h-[60vh] text-gray-400">
            <i class="fa-solid fa-map-location-dot text-4xl mb-4 text-sakura"></i>
            <p>地圖模式開發中...</p>
        </div>

    </main>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end justify-center sm:items-center bg-black/40 backdrop-blur-sm p-4" @click.self="closeModal">
        <div class="bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-bold mb-6 text-center text-gray-700">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
            
            <div class="space-y-4 max-h-[60vh] overflow-y-auto hide-scrollbar">
                <div>
                    <label class="text-xs font-bold text-gray-400 ml-1">分類</label>
                    <div class="flex gap-2 overflow-x-auto py-2 no-scrollbar">
                        <button v-for="cat in categories" :key="cat.value" 
                                @click="form.category = cat.value"
                                :class="['flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold transition border', 
                                form.category === cat.value ? 'bg-sakura text-white border-sakura shadow-md' : 'bg-white text-gray-500 border-gray-200']">
                            <i :class="cat.icon" class="mr-1"></i> {{ cat.label }}
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-3">
                    <div class="col-span-1">
                         <label class="text-xs font-bold text-gray-400 ml-1">時間</label>
                         <input v-model="form.time" type="time" class="w-full bg-gray-50 border border-gray-100 p-3 rounded-xl outline-none focus:border-sakura">
                    </div>
                    <div class="col-span-2">
                        <label class="text-xs font-bold text-gray-400 ml-1">名稱</label>
                        <input v-model="form.name" type="text" placeholder="景點名稱" class="w-full bg-gray-50 border border-gray-100 p-3 rounded-xl outline-none focus:border-sakura">
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-400 ml-1">標籤 (多選)</label>
                    <div class="flex gap-2 mt-1">
                        <button v-for="(cfg, key) in tagConfig" :key="key"
                                @click="toggleTag(key)"
                                :class="['px-3 py-1.5 rounded-lg text-xs font-bold border transition', 
                                form.tags.includes(key) ? cfg.activeClass : 'bg-white text-gray-400 border-gray-200']">
                            {{ cfg.label }}
                        </button>
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-400 ml-1">描述 / 備註</label>
                    <textarea v-model="form.desc" rows="2" placeholder="必吃菜單、注意事項..." class="w-full bg-gray-50 border border-gray-100 p-3 rounded-xl outline-none focus:border-sakura"></textarea>
                </div>
                
                <div>
                    <label class="text-xs font-bold text-gray-400 ml-1">Google Maps 地點關鍵字</label>
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-gray-300 text-xs"></i>
                        <input v-model="form.location" type="text" placeholder="用於導航搜尋" class="w-full bg-gray-50 border border-gray-100 p-3 pl-10 rounded-xl outline-none focus:border-sakura">
                    </div>
                </div>
            </div>

            <div class="mt-8 flex gap-3">
                <button v-if="isEditing" @click="deleteItem" class="flex-1 bg-gray-100 text-gray-500 py-3.5 rounded-2xl font-bold text-sm">刪除</button>
                <button @click="saveItem" class="flex-[2] bg-sakura text-white py-3.5 rounded-2xl font-bold text-sm shadow-lg shadow-pink-200">
                    {{ isEditing ? '儲存變更' : '確認新增' }}
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentTab: 'itinerary',
                tabs: [
                    { id: 'itinerary', icon: 'fa-solid fa-route' },
                    { id: 'map', icon: 'fa-solid fa-map-location-dot' },
                    { id: 'expenses', icon: 'fa-solid fa-yen-sign' },
                    { id: 'shopping', icon: 'fa-solid fa-basket-shopping' },
                ],
                selectedDayIndex: 0,
                days: [],
                weather: { 
                    icon: 'fa-solid fa-sun', 
                    color: 'text-orange-400', 
                    temp: 18, 
                    feelsLike: 16, 
                    desc: '晴朗',
                    location: '東京' 
                },
                
                // Modal Logic
                showModal: false,
                isEditing: false,
                editingId: null,
                
                // Forms
                form: { 
                    category: 'attraction', 
                    name: '', 
                    time: '', 
                    desc: '', 
                    location: '',
                    tags: [],
                    transportType: 'train',
                    travelTime: ''
                },

                // Configs
                categories: [
                    { label: '景點', value: 'attraction', icon: 'fa-camera' },
                    { label: '美食', value: 'food', icon: 'fa-utensils' },
                    { label: '購物', value: 'shopping', icon: 'fa-bag-shopping' },
                    { label: '住宿', value: 'hotel', icon: 'fa-bed' },
                    { label: '交通', value: 'transport', icon: 'fa-train' },
                    { label: '活動', value: 'activity', icon: 'fa-ticket' }
                ],
                tagConfig: {
                    'must-eat': { label: '必吃', class: 'text-tag-eat', activeClass: 'bg-orange-100 text-tag-eat border-orange-200' },
                    'must-buy': { label: '必買', class: 'text-tag-buy', activeClass: 'bg-purple-100 text-tag-buy border-purple-200' },
                    'must-photo': { label: '必拍', class: 'text-tag-photo', activeClass: 'bg-cyan-100 text-tag-photo border-cyan-200' }
                },

                // Data Store
                itineraryData: {}
            }
        },
        computed: {
            currentDateKey() {
                return this.days[this.selectedDayIndex]?.fullDate;
            },
            currentDayItinerary() {
                const list = this.itineraryData[this.currentDateKey] || [];
                return list.sort((a, b) => (a.time || '00:00').localeCompare(b.time || '00:00'));
            }
        },
        mounted() {
            this.generateDays();
            this.initData();
            this.updateWeather();
        },
        methods: {
            generateDays() {
                const start = new Date('2026-03-21');
                const end = new Date('2026-04-04');
                const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
                
                let current = start;
                while (current <= end) {
                    const month = current.getMonth() + 1;
                    const date = current.getDate();
                    const fullDateStr = `2026-${String(month).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
                    
                    this.days.push({
                        weekday: dayNames[current.getDay()],
                        dateParts: { month, day: date },
                        fullDate: fullDateStr
                    });
                    current.setDate(current.getDate() + 1);
                }
            },
            initData() {
                // Mock Data for Demo
                const setData = (dateStr, items) => this.itineraryData[dateStr] = items;

                setData('2026-03-25', [
                    { 
                        id: 1, category: 'transport', time: '09:40', name: '新幹線 光號', 
                        desc: '前往名古屋 (2hr)', location: 'Nagoya Station', tags: [], transportType: 'train'
                    },
                    { 
                        id: 2, category: 'food', time: '12:00', name: '矢場味噌豬排', 
                        desc: '名古屋名物，推薦鐵板味噌豬排定食', location: 'Yabaton Nagoya Station', tags: ['must-eat'], transportType: 'walk', travelTime: '10m' 
                    },
                    { 
                        id: 3, category: 'attraction', time: '14:30', name: '山崎川 四季之道', 
                        desc: '日本賞櫻百選之一，建議從石川橋走到新瑞橋', location: 'Yamazaki River', tags: ['must-photo'], transportType: 'subway', travelTime: '25m'
                    },
                    { 
                        id: 4, category: 'shopping', time: '17:00', name: '大須商店街', 
                        desc: '充滿復古風情的商店街，有二手衣跟小吃', location: 'Osu Shopping District', tags: ['must-buy', 'must-eat'], transportType: 'walk', travelTime: '15m'
                    },
                    {
                        id: 5, category: 'hotel', time: '19:00', name: '名古屋三井花園飯店', 
                        desc: 'Check-in, 記得領取包裹', location: 'Mitsui Garden Hotel Nagoya Premier', tags: [], transportType: 'subway', travelTime: '20m'
                    }
                ]);
            },
            updateWeather() {
                // Simple mock logic
                const date = this.days[this.selectedDayIndex];
                // 3/25-29 assumed Nagoya
                const isNagoya = (date.dateParts.month === 3 && date.dateParts.day >= 25);
                
                this.weather.location = isNagoya ? '名古屋' : '東京';
                // Randomize slightly
                const isSunny = Math.random() > 0.3;
                this.weather.icon = isSunny ? 'fa-solid fa-sun' : 'fa-solid fa-cloud-sun';
                this.weather.color = isSunny ? 'text-orange-400' : 'text-yellow-400';
                this.weather.desc = isSunny ? '晴朗舒爽' : '多雲時晴';
            },
            selectDay(index) {
                this.selectedDayIndex = index;
                this.updateWeather();
            },
            // UI Helpers
            getCategoryBg(cat) {
                const map = { 
                    attraction: 'bg-sakura', 
                    food: 'bg-orange-400', 
                    shopping: 'bg-purple-400', 
                    transport: 'bg-blue-400', 
                    hotel: 'bg-indigo-400', 
                    activity: 'bg-teal-400' 
                };
                return map[cat] || 'bg-gray-400';
            },
            getCategoryIcon(cat) {
                const c = this.categories.find(c => c.value === cat);
                return c ? c.icon : 'fa-circle';
            },
            getCategoryLabel(cat) {
                const c = this.categories.find(c => c.value === cat);
                return c ? c.label : cat;
            },
            getTransportIcon(type) {
                return type === 'walk' ? 'fa-solid fa-person-walking' : 'fa-solid fa-train-subway';
            },
            getTagStyle(tagKey) {
                return this.tagConfig[tagKey] ? this.tagConfig[tagKey].activeClass : 'bg-gray-100 text-gray-500';
            },
            getTagLabel(tagKey) {
                return this.tagConfig[tagKey] ? this.tagConfig[tagKey].label : tagKey;
            },
            
            // Actions
            openGoogleMaps(location) {
                const q = location || 'Japan';
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank');
            },
            
            // Modal Actions
            openAddModal() {
                this.isEditing = false;
                this.form = { category: 'attraction', name: '', time: '', desc: '', location: '', tags: [], transportType: 'train' };
                this.showModal = true;
            },
            editItem(item) {
                this.isEditing = true;
                this.editingId = item.id;
                // Deep copy to avoid direct mutation
                this.form = JSON.parse(JSON.stringify(item));
                if(!this.form.tags) this.form.tags = [];
                this.showModal = true;
            },
            toggleTag(key) {
                const idx = this.form.tags.indexOf(key);
                if(idx === -1) this.form.tags.push(key);
                else this.form.tags.splice(idx, 1);
            },
            saveItem() {
                const list = this.itineraryData[this.currentDateKey] || [];
                
                if (this.isEditing) {
                    const idx = list.findIndex(x => x.id === this.editingId);
                    if(idx !== -1) list[idx] = { ...this.form, id: this.editingId };
                } else {
                    if(!this.itineraryData[this.currentDateKey]) this.itineraryData[this.currentDateKey] = [];
                    this.itineraryData[this.currentDateKey].push({
                        ...this.form,
                        id: Date.now()
                    });
                }
                this.closeModal();
            },
            deleteItem() {
                if(confirm('確定刪除?')) {
                    const list = this.itineraryData[this.currentDateKey];
                    const idx = list.findIndex(x => x.id === this.editingId);
                    if(idx !== -1) list.splice(idx, 1);
                    this.closeModal();
                }
            },
            closeModal() {
                this.showModal = false;
            }
        }
    }).mount('#app');
</script>
</body>
</html>