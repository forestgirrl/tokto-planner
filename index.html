<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026日本F1櫻花自由行</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sakura: {
                            100: '#fff0f5',
                            200: '#ffcee0',
                            300: '#ffaec9',
                            500: '#ff69b4',
                        },
                        warm: {
                            50: '#fcfaf8',
                            100: '#f5f0eb',
                            500: '#8c8580',
                            900: '#4a4542',
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #fcfaf8; /* Warm 50 */
            font-family: 'Zen Maru Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* 隱藏 Scrollbar 但保留功能 */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
        }

        /* 標籤樣式 */
        .tag-food { background-color: #ffe4e6; color: #e11d48; }
        .tag-hotel { background-color: #e0e7ff; color: #3730a3; }
        .tag-shop { background-color: #fef3c7; color: #b45309; }
        .tag-spot { background-color: #d1fae5; color: #047857; }
        .tag-transport { background-color: #f3f4f6; color: #4b5563; }
        .tag-flight { background-color: #e0f2fe; color: #0369a1; }
        .tag-activity { background-color: #f3e8ff; color: #7e22ce; }

        .traffic-line {
            position: absolute;
            left: 24px;
            top: 100%;
            height: 30px;
            width: 2px;
            background-image: linear-gradient(to bottom, #cbd5e1 50%, transparent 50%);
            background-size: 2px 8px;
            z-index: 0;
        }
    </style>
</head>
<body class="text-warm-900 pb-24">

<div id="app">
    
    <header class="relative w-full h-[250px] overflow-hidden">
        <img src="f1cat.jpg" onerror="this.src='https://images.unsplash.com/photo-1522383225653-ed111181a951?q=80&w=1920&auto=format&fit=crop'" 
             alt="Header Banner" 
             class="w-full h-full object-cover">
        
        <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>

        <div class="absolute top-6 right-6 text-right text-white drop-shadow-md">
            <h1 class="text-xl font-bold tracking-widest">2026 日本F1櫻花自由行</h1>
            <p class="text-sm opacity-90 font-medium">03.21 — 04.04</p>
        </div>
    </header>

    <main class="relative -mt-8 bg-warm-50 rounded-t-[30px] min-h-screen px-4 pt-6 overflow-hidden z-10 shadow-[0_-10px_30px_rgba(0,0,0,0.1)]">
        
        <div v-if="currentTab === 'itinerary'">
            
            <div class="flex space-x-3 overflow-x-auto hide-scrollbar pb-4 mb-2">
                <div v-for="(day, index) in days" :key="index" 
                     @click="selectDate(index)"
                     class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 shadow-sm border"
                     :class="selectedDayIndex === index ? 'bg-sakura-500 text-white border-sakura-500 shadow-sakura-200' : 'bg-white text-gray-400 border-transparent'">
                    <span class="text-xs font-medium">{{ day.weekday }}</span>
                    <span class="text-2xl font-bold">{{ day.dateNum }}</span>
                </div>
            </div>

            <div class="bg-gradient-to-r from-blue-400 to-blue-300 text-white rounded-2xl p-4 mb-6 flex items-center justify-between shadow-lg shadow-blue-200">
                <div>
                    <div class="text-sm opacity-90">{{ days[selectedDayIndex].fullDate }} @ {{ getCurrentLocation() }}</div>
                    <div class="text-3xl font-bold mt-1">
                        {{ weatherData[selectedDayIndex]?.temp || '18' }}°C
                    </div>
                    <div class="text-xs mt-1 opacity-80">體感 {{ weatherData[selectedDayIndex]?.feel || '16' }}°C</div>
                </div>
                <div class="flex flex-col items-center">
                    <i :class="weatherData[selectedDayIndex]?.icon || 'fa-cloud-sun'" class="fas text-4xl mb-1"></i>
                    <span class="text-xs">{{ weatherData[selectedDayIndex]?.desc || '多雲時晴' }}</span>
                </div>
            </div>

            <div id="itinerary-list" class="space-y-6">
                
                <div v-for="(item, idx) in currentDayItems" :key="item.id" class="relative group">
                    
                    <div v-if="idx < currentDayItems.length - 1" class="traffic-line left-[28px] h-[40px] top-[100%] absolute z-0 border-l-2 border-dashed border-gray-300"></div>
                    <div v-if="idx < currentDayItems.length - 1" class="absolute left-[50px] -bottom-[25px] z-10 text-[10px] text-gray-400 bg-warm-50 px-2 py-0.5 rounded-full flex items-center gap-1">
                        <i class="fas fa-person-walking"></i> 15 min
                    </div>

                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-warm-100 relative z-10 flex gap-3" @click="openMap(item.name)">
                        
                        <div class="flex flex-col items-center justify-start pt-1 min-w-[50px]">
                            <div class="text-xs font-bold text-gray-400 mb-1">{{ item.time || '--:--' }}</div>
                            <div class="w-2 h-2 rounded-full bg-sakura-300"></div>
                        </div>

                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                <span :class="getCategoryClass(item.category)" class="text-[10px] font-bold px-2 py-0.5 rounded-full">
                                    {{ getCategoryLabel(item.category) }}
                                </span>
                                <span v-if="item.mustEat" class="bg-red-100 text-red-500 text-[10px] px-1.5 py-0.5 rounded border border-red-200">必吃</span>
                                <span v-if="item.mustBuy" class="bg-yellow-100 text-yellow-600 text-[10px] px-1.5 py-0.5 rounded border border-yellow-200">必買</span>
                            </div>

                            <h3 class="font-bold text-lg text-warm-900 leading-tight">{{ item.name }}</h3>
                            <p class="text-xs text-gray-500 mt-1 line-clamp-2">{{ item.desc }}</p>

                            <div v-if="item.category === 'flight'" class="mt-3 bg-slate-50 p-2 rounded-lg border border-slate-100">
                                <div class="flex justify-between items-center text-xs font-bold text-slate-700">
                                    <span>TPE</span>
                                    <i class="fas fa-plane text-slate-400"></i>
                                    <span>NRT</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                                    <span>10:55</span>
                                    <span>14:55</span>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 mt-3">
                                <button class="text-[10px] bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full flex items-center gap-1">
                                    <i class="fas fa-location-arrow"></i> 導航
                                </button>
                                <label class="text-[10px] bg-gray-50 text-gray-500 px-3 py-1.5 rounded-full flex items-center gap-1 cursor-pointer">
                                    <i class="fas fa-camera"></i> 
                                    <input type="file" class="hidden" @change="uploadPhoto($event, item)">
                                    {{ item.photo ? '更換照片' : '照片' }}
                                </label>
                                <button @click.stop="deleteItem(item)" class="text-[10px] text-red-300 px-2">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div v-if="item.photo" class="w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 bg-gray-100">
                            <img :src="item.photo" class="w-full h-full object-cover">
                        </div>
                    </div>
                </div>

                <div class="h-20 flex items-center justify-center">
                   </div>
            </div>

            <button @click="showAddModal = true" class="fixed bottom-24 right-5 w-14 h-14 bg-sakura-500 text-white rounded-full shadow-lg shadow-sakura-300 flex items-center justify-center text-2xl z-40 transition-transform active:scale-95">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'expenses'">
            <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 text-center relative overflow-hidden">
                <div class="absolute -right-4 -top-4 w-24 h-24 bg-yellow-100 rounded-full opacity-50"></div>
                <h2 class="text-sm text-gray-500">總支出 (JPY)</h2>
                <div class="text-4xl font-bold text-warm-900 mt-1">¥ {{ totalExpenses.toLocaleString() }}</div>
                <p class="text-xs text-gray-400 mt-2">約 TWD {{ (totalExpenses * exchangeRate).toFixed(0).toLocaleString() }}</p>
            </div>

            <div class="space-y-3 pb-24">
                <div v-for="(exp, index) in expenses" :key="index" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center border border-warm-100">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-lg text-gray-400">
                            <i :class="getExpenseIcon(exp.category)"></i>
                        </div>
                        <div>
                            <div class="font-bold text-sm">{{ exp.name }}</div>
                            <div class="text-xs text-gray-400">{{ exp.date }} · {{ exp.payment }}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-warm-900">-¥{{ exp.amount }}</div>
                        <button @click="deleteExpense(index)" class="text-xs text-red-300 mt-1"><i class="fas fa-times"></i></button>
                    </div>
                </div>
            </div>
             <button @click="showExpenseModal = true" class="fixed bottom-24 right-5 w-14 h-14 bg-yellow-400 text-white rounded-full shadow-lg shadow-yellow-200 flex items-center justify-center text-2xl z-40">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'shopping'">
            <div class="grid grid-cols-2 gap-4 pb-24">
                <div v-for="(shop, index) in shoppingList" :key="index" class="bg-white rounded-xl shadow-sm overflow-hidden border border-warm-100 flex flex-col">
                    <div class="h-32 bg-gray-100 relative">
                        <img v-if="shop.photo" :src="shop.photo" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-300"><i class="fas fa-image text-2xl"></i></div>
                        <button @click="deleteShoppingItem(index)" class="absolute top-2 right-2 w-6 h-6 bg-white/80 rounded-full text-red-400 flex items-center justify-center text-xs"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="p-3 flex-1 flex flex-col justify-between">
                        <h3 class="font-bold text-sm">{{ shop.name }}</h3>
                        <label class="mt-2 text-[10px] text-center w-full py-1.5 border border-gray-200 rounded-lg text-gray-500 cursor-pointer block">
                            上傳圖片
                            <input type="file" class="hidden" @change="uploadShopPhoto($event, index)">
                        </label>
                    </div>
                </div>
            </div>
             <button @click="addShoppingItem" class="fixed bottom-24 right-5 w-14 h-14 bg-sakura-500 text-white rounded-full shadow-lg shadow-sakura-300 flex items-center justify-center text-2xl z-40">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="pb-24 space-y-6">
            
            <div class="bg-white rounded-xl p-5 shadow-sm border border-warm-100">
                <h3 class="font-bold text-warm-900 mb-3 flex items-center gap-2">
                    <i class="fas fa-coins text-yellow-500"></i> 匯率換算
                </h3>
                <div class="flex items-center gap-2">
                    <input type="number" v-model="calcJpy" class="bg-gray-50 rounded-lg p-2 w-full text-lg outline-none focus:ring-2 focus:ring-sakura-300" placeholder="日幣">
                    <span class="text-gray-400">=</span>
                    <div class="text-xl font-bold text-warm-900 w-full text-right">NT$ {{ (calcJpy * exchangeRate).toFixed(0) }}</div>
                </div>
                <div class="text-xs text-right text-gray-400 mt-1">匯率設定: {{ exchangeRate }}</div>
            </div>

            <div class="bg-white rounded-xl p-5 shadow-sm border border-warm-100">
                 <h3 class="font-bold text-warm-900 mb-3 flex items-center gap-2">
                    <i class="fas fa-plane text-blue-500"></i> 航班資訊
                </h3>
                <div class="border-b border-dashed border-gray-200 pb-3 mb-3">
                    <div class="flex justify-between text-xs font-bold text-sakura-500 mb-1">去程 3/21 JL802</div>
                    <div class="flex justify-between items-center">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-warm-900">TPE</div>
                            <div class="text-xs text-gray-500">10:55</div>
                        </div>
                        <div class="flex-1 px-4 text-center">
                            <div class="text-[10px] text-gray-400">3h 55m</div>
                            <div class="h-[1px] bg-gray-300 relative w-full my-1">
                                <i class="fas fa-plane absolute top-[-7px] left-1/2 -translate-x-1/2 text-gray-300 text-xs"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-warm-900">NRT</div>
                            <div class="text-xs text-gray-500">14:55</div>
                        </div>
                    </div>
                </div>
                 <div>
                    <div class="flex justify-between text-xs font-bold text-sakura-500 mb-1">回程 4/04 JL099</div>
                    <div class="flex justify-between items-center">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-warm-900">HND</div>
                            <div class="text-xs text-gray-500">18:20</div>
                        </div>
                        <div class="flex-1 px-4 text-center">
                            <div class="text-[10px] text-gray-400">3h 20m</div>
                            <div class="h-[1px] bg-gray-300 relative w-full my-1">
                                <i class="fas fa-plane absolute top-[-7px] left-1/2 -translate-x-1/2 text-gray-300 text-xs transform rotate-180"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-warm-900">TSA</div>
                            <div class="text-xs text-gray-500">20:40</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-5 shadow-sm border border-warm-100">
                <h3 class="font-bold text-warm-900 mb-3 flex items-center gap-2">
                   <i class="fas fa-bed text-indigo-500"></i> 住宿清單
               </h3>
               <ul class="space-y-3">
                   <li class="flex justify-between items-center border-b border-gray-50 pb-2">
                       <span class="text-sm font-medium">秋葉原雷姆飯店</span>
                       <a href="https://maps.google.com/?q=秋葉原雷姆飯店" target="_blank" class="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">Map</a>
                   </li>
                   <li class="flex justify-between items-center border-b border-gray-50 pb-2">
                       <span class="text-sm font-medium">東京迪士尼海洋夢幻泉鄉大飯店</span>
                       <a href="https://maps.google.com/?q=東京迪士尼海洋夢幻泉鄉大飯店" target="_blank" class="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">Map</a>
                   </li>
                    <li class="flex justify-between items-center border-b border-gray-50 pb-2">
                       <span class="text-sm font-medium">名古屋三井花園飯店</span>
                       <a href="https://maps.google.com/?q=名古屋三井花園飯店" target="_blank" class="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">Map</a>
                   </li>
               </ul>
           </div>
        </div>

    </main>

    <nav class="fixed bottom-0 left-0 w-full glass-nav pb-6 pt-3 px-6 z-50 flex justify-between items-center">
        <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'text-sakura-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition-colors">
            <i class="fas fa-map-location-dot text-xl"></i>
            <span class="text-[10px] font-medium">行程</span>
        </button>
        <button @click="currentTab = 'expenses'" :class="currentTab === 'expenses' ? 'text-sakura-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition-colors">
            <i class="fas fa-yen-sign text-xl"></i>
            <span class="text-[10px] font-medium">花費</span>
        </button>
        <button @click="currentTab = 'shopping'" :class="currentTab === 'shopping' ? 'text-sakura-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition-colors">
            <i class="fas fa-bag-shopping text-xl"></i>
            <span class="text-[10px] font-medium">購物</span>
        </button>
        <button @click="currentTab = 'info'" :class="currentTab === 'info' ? 'text-sakura-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition-colors">
            <i class="fas fa-circle-info text-xl"></i>
            <span class="text-[10px] font-medium">資訊</span>
        </button>
    </nav>

    <div v-if="showAddModal" class="fixed inset-0 z-50 flex items-end justify-center sm:items-center bg-black/50 backdrop-blur-sm" @click.self="showAddModal = false">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl animate-slide-up">
            <h3 class="text-lg font-bold mb-4">新增行程</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500 block mb-1">類別</label>
                    <select v-model="newItem.category" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm">
                        <option value="spot">景點</option>
                        <option value="food">美食</option>
                        <option value="shop">購物</option>
                        <option value="hotel">住宿</option>
                        <option value="transport">交通</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500 block mb-1">名稱</label>
                    <input v-model="newItem.name" type="text" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm">
                </div>
                <div>
                    <label class="text-xs text-gray-500 block mb-1">時間</label>
                    <input v-model="newItem.time" type="time" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm">
                </div>
                <div class="flex gap-2">
                     <label class="flex items-center gap-2 text-sm text-gray-600">
                        <input type="checkbox" v-model="newItem.mustEat" class="rounded text-sakura-500 focus:ring-sakura-500"> 必吃
                     </label>
                     <label class="flex items-center gap-2 text-sm text-gray-600">
                        <input type="checkbox" v-model="newItem.mustBuy" class="rounded text-sakura-500 focus:ring-sakura-500"> 必買
                     </label>
                </div>
            </div>

            <button @click="confirmAdd" class="w-full bg-sakura-500 text-white font-bold py-3 rounded-xl mt-6 shadow-lg shadow-sakura-200">
                確認新增
            </button>
        </div>
    </div>
    
    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-end justify-center sm:items-center bg-black/50 backdrop-blur-sm" @click.self="showExpenseModal = false">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl">
            <h3 class="text-lg font-bold mb-4">記一筆</h3>
            <div class="space-y-3">
                 <input v-model="newExpense.name" placeholder="項目名稱" class="w-full bg-gray-50 p-3 rounded-lg border-none text-sm">
                 <input v-model.number="newExpense.amount" type="number" placeholder="金額 (JPY)" class="w-full bg-gray-50 p-3 rounded-lg border-none text-sm">
                 <select v-model="newExpense.category" class="w-full bg-gray-50 p-3 rounded-lg border-none text-sm">
                     <option value="food">飲食</option>
                     <option value="shop">購物</option>
                     <option value="transport">交通</option>
                     <option value="ticket">門票</option>
                     <option value="other">其他</option>
                 </select>
            </div>
            <button @click="confirmAddExpense" class="w-full bg-yellow-400 text-white font-bold py-3 rounded-xl mt-6">儲存</button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const selectedDayIndex = ref(0);
            const showAddModal = ref(false);
            const showExpenseModal = ref(false);
            
            const calcJpy = ref(1000);
            const exchangeRate = ref(0.21); // 假設匯率

            // Generate Date List: 2026/3/21 to 4/4
            const days = ref([]);
            const startDate = new Date('2026-03-21');
            const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            for(let i=0; i<15; i++){
                let d = new Date(startDate);
                d.setDate(startDate.getDate() + i);
                days.value.push({
                    fullDate: `${d.getMonth()+1}/${d.getDate()}`,
                    dateNum: d.getDate(),
                    weekday: weekDays[d.getDay()],
                    iso: d.toISOString().split('T')[0]
                });
            }

            // Weather Mock Data
            const weatherData = [
                {temp: 16, icon: 'fa-cloud-sun', desc: '多雲', feel: 14}, // 3/21
                {temp: 18, icon: 'fa-sun', desc: '晴朗', feel: 19}, // 3/22
                {temp: 15, icon: 'fa-cloud-rain', desc: '小雨', feel: 13}, // 3/23
                {temp: 17, icon: 'fa-sun', desc: '晴朗', feel: 17}, // 3/24 Disney
                {temp: 20, icon: 'fa-sun', desc: '晴時多雲', feel: 21}, // 3/25 Nagoya
                {temp: 22, icon: 'fa-flag-checkered', desc: '多雲', feel: 22}, // 3/26 F1
                {temp: 19, icon: 'fa-sun', desc: '晴朗', feel: 19}, // 3/27
                {temp: 21, icon: 'fa-sun', desc: '晴朗', feel: 22}, // 3/28
                {temp: 23, icon: 'fa-sun', desc: '大晴天', feel: 25}, // 3/29 F1 Final
                {temp: 18, icon: 'fa-train', desc: '多雲', feel: 17}, // 3/30
                {temp: 15, icon: 'fa-cloud', desc: '陰天', feel: 14}, // 3/31
                {temp: 17, icon: 'fa-fan', desc: '微風', feel: 16}, // 4/1
                {temp: 19, icon: 'fa-sun', desc: '晴朗', feel: 19}, // 4/2
                {temp: 18, icon: 'fa-cloud-sun', desc: '多雲', feel: 17}, // 4/3
                {temp: 19, icon: 'fa-plane-departure', desc: '晴朗', feel: 19}, // 4/4
            ];

            // Initial Itinerary Data
            const itineraryData = ref({
                0: [ // 3/21
                    { id: 1, name: 'JL802 航班', category: 'flight', time: '10:55', desc: 'TPE T2 -> NRT T2' },
                    { id: 2, name: '秋葉原 Check-in', category: 'hotel', time: '16:00', desc: '雷姆飯店' },
                    { id: 3, name: '秋葉原挖寶', category: 'shop', time: '17:00', desc: '動漫逛街、吃晚餐', mustBuy: true }
                ],
                1: [ // 3/22
                    { id: 11, name: '築地市場', category: 'food', time: '09:00', desc: '吃吃喝喝', mustEat: true },
                    { id: 12, name: '初音演唱會', category: 'activity', time: '12:00', desc: 'LaLa arena TOKYO-BAY', ticket: true },
                    { id: 13, name: '錦糸公園', category: 'spot', time: '16:00', desc: '櫻花 + 東京晴空塔', mustEat: false },
                    { id: 14, name: '霧島相撲鍋', category: 'food', time: '19:00', desc: '兩國站 江戶風情' }
                ],
                2: [ // 3/23 Disney
                    { id: 21, name: '伊克斯皮兒莉', category: 'shop', time: '12:00', desc: '購物中心午餐' },
                    { id: 22, name: 'Tokyo Disneyland', category: 'activity', time: '14:00', desc: '簡單玩玩 看煙火', ticket: true },
                    { id: 23, name: '迪士尼海洋夢幻泉鄉', category: 'hotel', time: '21:00', desc: '夢幻館住宿' }
                ],
                4: [ // 3/25 Move to Nagoya
                     { id: 41, name: '新幹線往名古屋', category: 'transport', time: '09:30', desc: '東京站 -> 名古屋站 (約2hrs)' },
                     { id: 42, name: '山崎川 四季之道', category: 'spot', time: '13:00', desc: '賞櫻散步 石川橋〜新瑞橋' },
                     { id: 43, name: '大須商店街', category: 'shop', time: '15:30', desc: '三輪神社、萬松寺通' },
                     { id: 44, name: '名古屋三井花園飯店', category: 'hotel', time: '18:00', desc: 'Check-in' }
                ],
                5: [ // 3/26 F1
                    { id: 51, name: '鈴鹿賽道', category: 'activity', time: '13:00', desc: 'F1 練習賽體驗' }
                ],
                8: [ // 3/29 F1 Final
                    { id: 81, name: 'F1 鈴鹿賽道 決賽', category: 'activity', time: '10:00', desc: '整天熱血！', ticket: true }
                ]
            });

            // Initialize empty arrays for other days
            for(let i=0; i<15; i++) {
                if(!itineraryData.value[i]) itineraryData.value[i] = [];
            }

            const currentDayItems = computed(() => {
                return itineraryData.value[selectedDayIndex.value] || [];
            });

            // Shopping List
            const shoppingList = ref([
                { name: 'F1 Red Bull 帽子', photo: '' },
                { name: '東京巴奈奈', photo: '' },
                { name: '藥妝 (EVE, 合利他命)', photo: '' }
            ]);

            // Expenses
            const expenses = ref([
                { category: 'transport', name: '新幹線票', amount: 11000, date: '3/25', payment: 'Card' },
                { category: 'food', name: '便利商店', amount: 1500, date: '3/21', payment: 'Cash' }
            ]);

            const totalExpenses = computed(() => {
                return expenses.value.reduce((sum, item) => sum + item.amount, 0);
            });

            // Form Models
            const newItem = ref({ category: 'spot', name: '', time: '', mustEat: false, mustBuy: false });
            const newExpense = ref({ category: 'food', name: '', amount: null, date: '', payment: 'Cash' });

            // Methods
            const selectDate = (index) => {
                selectedDayIndex.value = index;
            };

            const getCategoryClass = (cat) => {
                const map = {
                    food: 'tag-food', hotel: 'tag-hotel', shop: 'tag-shop',
                    spot: 'tag-spot', transport: 'tag-transport', flight: 'tag-flight', activity: 'tag-activity'
                };
                return map[cat] || 'tag-spot';
            };
            
            const getCategoryLabel = (cat) => {
                const map = { food: '美食', hotel: '住宿', shop: '購物', spot: '景點', transport: '交通', flight: '航班', activity: '活動' };
                return map[cat] || '其他';
            };

            const getExpenseIcon = (cat) => {
                const map = { food: 'fa-utensils', shop: 'fa-bag-shopping', transport: 'fa-train', ticket: 'fa-ticket', other: 'fa-circle-question' };
                return `fas ${map[cat] || 'fa-circle'}`;
            };

            const openMap = (query) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            };

            const getCurrentLocation = () => {
                // Logic based on date to show "Tokyo" or "Nagoya"
                if (selectedDayIndex.value >= 4 && selectedDayIndex.value <= 9) return '名古屋';
                return '東京';
            };

            const confirmAdd = () => {
                if(!newItem.value.name) return;
                itineraryData.value[selectedDayIndex.value].push({
                    id: Date.now(),
                    ...newItem.value
                });
                // Simple Sort by time
                itineraryData.value[selectedDayIndex.value].sort((a,b) => a.time.localeCompare(b.time));
                showAddModal.value = false;
                newItem.value = { category: 'spot', name: '', time: '', mustEat: false, mustBuy: false };
                saveData();
            };

            const deleteItem = (item) => {
                if(confirm(`確定要刪除 ${item.name} 嗎?`)) {
                    const arr = itineraryData.value[selectedDayIndex.value];
                    const idx = arr.indexOf(item);
                    if(idx > -1) arr.splice(idx, 1);
                    saveData();
                }
            };

            const confirmAddExpense = () => {
                if(!newExpense.value.name) return;
                expenses.value.unshift({
                    ...newExpense.value,
                    date: days.value[selectedDayIndex.value].fullDate
                });
                showExpenseModal.value = false;
                newExpense.value = { category: 'food', name: '', amount: null, date: '', payment: 'Cash' };
                saveData();
            };

            const deleteExpense = (index) => {
                expenses.value.splice(index, 1);
                saveData();
            };

            const addShoppingItem = () => {
                const name = prompt("請輸入想買的商品名稱：");
                if(name) shoppingList.value.push({ name: name, photo: '' });
                saveData();
            };

            const deleteShoppingItem = (index) => {
                if(confirm('刪除此商品?')) shoppingList.value.splice(index, 1);
                saveData();
            };

            // Image Upload handling (convert to Base64 for local demo)
            const uploadPhoto = (event, item) => {
                const file = event.target.files[0];
                if(file){
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        item.photo = e.target.result;
                        saveData();
                    };
                    reader.readAsDataURL(file);
                }
            };
            const uploadShopPhoto = (event, index) => {
                const file = event.target.files[0];
                if(file){
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        shoppingList.value[index].photo = e.target.result;
                        saveData();
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Persistence
            const saveData = () => {
                localStorage.setItem('trip_data_2026', JSON.stringify({
                    itinerary: itineraryData.value,
                    expenses: expenses.value,
                    shopping: shoppingList.value
                }));
            };

            onMounted(() => {
                const saved = localStorage.getItem('trip_data_2026');
                if(saved) {
                    const parsed = JSON.parse(saved);
                    // Merge saved data lightly
                    Object.assign(itineraryData.value, parsed.itinerary);
                    expenses.value = parsed.expenses;
                    shoppingList.value = parsed.shopping;
                }
                
                // Initialize Drag and Drop logic (SortableJS)
                // This would need a watcher on DOM update usually, but for simple demo:
                // Note: For full draggable reactivity in Vue, v-draggable libraries are better, 
                // but this is a vanilla-ish implementation.
            });

            return {
                currentTab, days, selectedDayIndex, weatherData,
                currentDayItems, shoppingList, expenses, totalExpenses,
                showAddModal, showExpenseModal, newItem, newExpense,
                calcJpy, exchangeRate,
                selectDate, getCategoryClass, getCategoryLabel, getExpenseIcon,
                openMap, confirmAdd, deleteItem, confirmAddExpense, deleteExpense,
                addShoppingItem, deleteShoppingItem, uploadPhoto, uploadShopPhoto,
                getCurrentLocation
            };
        }
    }).mount('#app');
</script>

<style>
@keyframes slide-up {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}
.animate-slide-up {
    animation: slide-up 0.3s ease-out;
}
</style>
</body>
</html>