<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>日本F1櫻花自由行</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sakura: {
                            light: '#FFF0F5', // 淺粉
                            DEFAULT: '#FFB7C5', // 櫻花粉
                            dark: '#FF8FAB', // 深粉
                        },
                        warm: {
                            white: '#FAFAFA', // 雪白
                            grey: '#F2EBE5', // 暖灰
                            text: '#595048' // 深暖灰字體
                        },
                        f1: {
                            red: '#E10600' // F1 紅
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        body {
            background-color: #FDFBF9;
            color: #595048;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .content-wrapper {
            margin-top: -30px;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            background-color: #FDFBF9;
            position: relative;
            z-index: 10;
            padding-top: 20px;
            min-height: calc(100vh - 220px);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }

        .nav-tabs {
            position: absolute;
            bottom: 40px;
            right: 15px;
            display: flex;
            gap: 15px;
            z-index: 20;
        }
        .nav-item {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(4px);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FFB7C5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .nav-item.active {
            background: #FFB7C5;
            color: white;
            transform: translateY(-5px);
            border: 2px solid white;
        }

        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(255, 183, 197, 0.15);
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); }

        /* Weather Animation Keyframes */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .weather-icon-anim {
            animation: float 3s ease-in-out infinite;
        }

        .modal-enter-active, .modal-leave-active { transition: opacity 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; }
        
        /* Slide up animation for modal content */
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }
    </style>
</head>
<body>

<div id="app" class="pb-20">

    <header class="relative w-full h-[250px]">
        <div class="w-full h-full overflow-hidden">
            <img src="f1cat.jpg" onerror="this.src='https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1920&auto=format&fit=crop'" alt="Header Image" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
        </div>

        <div class="absolute top-6 right-4 text-right text-white drop-shadow-md">
            <h1 class="text-2xl font-bold tracking-widest">日本F1櫻花自由行</h1>
            <p class="text-sm opacity-90 font-medium mt-1">2026.03.21 - 04.04</p>
        </div>

        <div class="nav-tabs">
            <div @click="currentTab = 'itinerary'" :class="['nav-item', currentTab === 'itinerary' ? 'active' : '']">
                <i class="fa-solid fa-route text-lg"></i>
            </div>
            <div @click="currentTab = 'map'" :class="['nav-item', currentTab === 'map' ? 'active' : '']">
                <i class="fa-solid fa-map-location-dot text-lg"></i>
            </div>
            <div @click="currentTab = 'expenses'" :class="['nav-item', currentTab === 'expenses' ? 'active' : '']">
                <i class="fa-solid fa-yen-sign text-lg"></i>
            </div>
            <div @click="currentTab = 'shopping'" :class="['nav-item', currentTab === 'shopping' ? 'active' : '']">
                <i class="fa-solid fa-basket-shopping text-lg"></i>
            </div>
            <div @click="currentTab = 'info'" :class="['nav-item', currentTab === 'info' ? 'active' : '']">
                <i class="fa-solid fa-circle-info text-lg"></i>
            </div>
        </div>
    </header>

    <main class="content-wrapper px-4">
        
        <div v-if="currentTab === 'itinerary'">
            
            <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-6 pb-2">
                <div v-for="(day, index) in days" :key="index" 
                     @click="selectDay(index)"
                     :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl transition-all duration-300 border-2', 
                              selectedDayIndex === index ? 'bg-sakura text-white border-sakura shadow-lg transform scale-105' : 'bg-white text-warm-text border-transparent']">
                    <span class="text-xs font-bold uppercase tracking-wider">{{ day.weekday }}</span>
                    <span class="text-2xl font-black">{{ day.date }}</span>
                </div>
            </div>

            <div class="relative bg-gradient-to-r from-blue-50 to-white rounded-2xl p-4 mb-6 shadow-sm border border-blue-100 flex items-center justify-between overflow-hidden">
                <div class="absolute -right-4 -top-4 text-9xl opacity-5 pointer-events-none">
                    <i :class="weather.icon"></i>
                </div>

                <div class="flex items-center gap-4 z-10">
                    <div class="text-4xl weather-icon-anim" :class="weather.color">
                        <i :class="weather.icon"></i>
                    </div>
                    
                    <div>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-black text-gray-700">{{ weather.temp }}°</span>
                            <span class="text-sm text-gray-500">C</span>
                        </div>
                        <div class="text-xs text-gray-500 font-medium">
                            體感 {{ weather.feelsLike }}°C <span class="mx-1">·</span> {{ weather.desc }}
                        </div>
                    </div>
                </div>

                <div class="text-right z-10">
                    <div class="text-sm font-bold text-gray-600 flex items-center justify-end gap-1">
                        <i class="fa-solid fa-location-dot text-sakura"></i>
                        {{ weather.location }}
                    </div>
                    <div class="text-[10px] text-gray-400 mt-1">
                        預報準確率 80%
                    </div>
                </div>
            </div>

            <div id="itinerary-list" class="relative pb-24">
                <div v-for="(item, index) in currentDayItinerary" :key="item.id" class="relative pl-0 mb-4 group cursor-grab active:cursor-grabbing">
                    
                    <div v-if="index > 0 || (index === 0 && item.travelTimeFromHotel)" class="flex items-center justify-center py-2 text-xs text-gray-400 gap-2">
                        <i :class="getTransportIcon(item.transportType)"></i>
                        <span>{{ item.travelTime || item.travelTimeFromHotel }}</span>
                        <div class="h-[1px] bg-gray-200 flex-grow max-w-[50px]"></div>
                    </div>

                    <div @click="openGoogleMaps(item.location)" class="card p-4 flex gap-4 items-start border-l-4" :class="getCategoryColor(item.category)">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white flex-shrink-0" :class="getCategoryBg(item.category)">
                            <i :class="getCategoryIcon(item.category)"></i>
                        </div>

                        <div class="flex-grow">
                            <div v-if="item.isFlight" class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold text-blue-800">{{ item.flightCode }}</span>
                                    <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded-full">飛行 {{ item.duration }}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <div class="text-center">
                                        <div class="font-bold text-lg">{{ item.depTime }}</div>
                                        <div class="text-xs text-gray-500">{{ item.depAirport }}</div>
                                    </div>
                                    <i class="fa-solid fa-plane text-gray-300"></i>
                                    <div class="text-center">
                                        <div class="font-bold text-lg">{{ item.arrTime }}</div>
                                        <div class="text-xs text-gray-500">{{ item.arrAirport }}</div>
                                    </div>
                                </div>
                            </div>

                            <div v-else>
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg text-gray-800 leading-tight">{{ item.name }}</h3>
                                    <span class="text-xs font-mono bg-gray-100 px-2 py-1 rounded text-gray-500">{{ item.time || '彈性' }}</span>
                                </div>
                                
                                <div class="mt-2 space-y-1">
                                    <p v-if="item.tags" class="text-sm text-sakura-dark"><i class="fa-solid fa-tag mr-1"></i>{{ item.tags }}</p>
                                    <p v-if="item.ticket" class="text-sm text-orange-500"><i class="fa-solid fa-ticket mr-1"></i>{{ item.ticket }}</p>
                                    <p v-if="item.note" class="text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded">{{ item.note }}</p>
                                </div>
                            </div>
                        </div>

                        <button @click.stop="editItem(item)" class="text-gray-300 hover:text-gray-500 p-1">
                            <i class="fa-solid fa-ellipsis-vertical"></i>
                        </button>
                    </div>
                </div>

                <div v-if="currentDayItinerary.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-solid fa-suitcase-rolling text-4xl mb-3 opacity-30"></i>
                    <p>今天還沒有行程安排</p>
                </div>
            </div>

            <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-sakura hover:bg-sakura-dark text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40 transition-transform hover:scale-110 active:scale-90">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'map'" class="h-[60vh] bg-gray-100 rounded-2xl overflow-hidden shadow-inner relative">
            <div class="absolute inset-0 flex items-center justify-center flex-col text-gray-400 bg-gray-200">
                 <iframe width="100%" height="100%" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3240.828030588698!2d139.7671248!3d35.6812362!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188bfbd89f7007%3A0x277c49ba34ed38!2z5p2x5Lqs6LuK56uZ!5e0!3m2!1szh-TW!2stw!4v1700000000000!5m2!1szh-TW!2stw"></iframe>
                <div class="pointer-events-none absolute bottom-4 bg-white/90 px-4 py-2 rounded-lg shadow text-xs text-center">
                    顯示本日行程路徑
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'expenses'">
            <div class="bg-gradient-to-r from-sakura to-sakura-dark text-white rounded-2xl p-6 mb-6 shadow-lg">
                <p class="text-sm opacity-90 mb-1">總支出 (TWD)</p>
                <h2 class="text-4xl font-bold">NT$ {{ totalExpenseTWD.toLocaleString() }}</h2>
                <div class="mt-4 flex gap-4 text-xs opacity-80">
                    <span><i class="fa-solid fa-money-bill-wave mr-1"></i>現金: {{ expenseStats.cash }}%</span>
                    <span><i class="fa-regular fa-credit-card mr-1"></i>信用卡: {{ expenseStats.card }}%</span>
                </div>
            </div>
            <div class="space-y-3 pb-24">
                <div v-for="expense in expenses" :key="expense.id" class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500">
                            <i :class="getExpenseIcon(expense.category)"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-700">{{ expense.name }}</div>
                            <div class="text-xs text-gray-400">{{ expense.date }} · {{ expense.payment }}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-gray-800">¥{{ expense.amount.toLocaleString() }}</div>
                        <div class="text-xs text-gray-400">NT${{ Math.round(expense.amount * 0.21).toLocaleString() }}</div>
                    </div>
                </div>
            </div>
            <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-yellow-400 hover:bg-yellow-500 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'shopping'">
            <div class="grid grid-cols-2 gap-4 pb-24">
                <div v-for="item in shoppingList" :key="item.id" class="bg-white rounded-xl overflow-hidden shadow-sm group">
                    <div class="h-32 bg-gray-100 relative overflow-hidden">
                        <div v-if="!item.image" class="w-full h-full flex items-center justify-center text-gray-300">
                            <i class="fa-solid fa-image text-2xl"></i>
                        </div>
                        <img v-else :src="item.image" class="w-full h-full object-cover">
                        <div class="absolute top-2 right-2">
                             <input type="checkbox" v-model="item.bought" class="w-5 h-5 accent-sakura rounded border-gray-300">
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-bold text-gray-800 truncate" :class="{'line-through text-gray-400': item.bought}">{{ item.name }}</h3>
                        <p class="text-xs text-gray-400 mt-1">預計: ¥{{ item.price }}</p>
                    </div>
                </div>
            </div>
            <button @click="showShoppingModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-purple-400 hover:bg-purple-500 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6 pb-24">
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-800 mb-3"><i class="fa-solid fa-calculator mr-2 text-sakura"></i>匯率換算</h3>
                <div class="flex items-center gap-2">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400 block mb-1">日幣 (JPY)</label>
                        <input type="number" v-model="calcJPY" class="w-full bg-gray-50 rounded-lg p-2 font-mono text-lg outline-none focus:ring-2 ring-sakura/50">
                    </div>
                    <i class="fa-solid fa-arrow-right text-gray-300 mt-4"></i>
                    <div class="flex-1">
                        <label class="block text-xs text-gray-400 mb-1">台幣 (TWD)</label>
                        <div class="w-full bg-gray-50 rounded-lg p-2 font-mono text-lg text-gray-700">{{ calculatedTWD }}</div>
                    </div>
                </div>
                <div class="text-xs text-right text-gray-400 mt-2">匯率: 0.215</div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-gray-800 pl-2 border-l-4 border-sakura">航班資訊</h3>
                <div class="bg-white p-4 rounded-xl shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-blue-400"></div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded font-bold">去程</span>
                        <span class="text-sm font-bold text-gray-600">JL802</span>
                    </div>
                    <div class="flex justify-between items-center text-center">
                        <div>
                            <div class="text-2xl font-black text-gray-800">10:55</div>
                            <div class="text-xs text-gray-500">TPE 桃園</div>
                        </div>
                        <div class="flex-1 px-4 flex flex-col items-center">
                            <span class="text-xs text-gray-400">3h 00m</span>
                            <div class="w-full h-[1px] bg-gray-300 my-1 relative">
                                <i class="fa-solid fa-plane absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-gray-400 bg-white px-1"></i>
                            </div>
                        </div>
                        <div>
                            <div class="text-2xl font-black text-gray-800">14:55</div>
                            <div class="text-xs text-gray-500">NRT 成田</div>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-400 border-t pt-2">2026/03/21 (Sat) · 經濟艙</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-sakura-dark"></div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded font-bold">回程</span>
                        <span class="text-sm font-bold text-gray-600">JL099</span>
                    </div>
                    <div class="flex justify-between items-center text-center">
                        <div>
                            <div class="text-2xl font-black text-gray-800">18:20</div>
                            <div class="text-xs text-gray-500">HND 羽田</div>
                        </div>
                        <div class="flex-1 px-4 flex flex-col items-center">
                            <span class="text-xs text-gray-400">3h 20m</span>
                            <div class="w-full h-[1px] bg-gray-300 my-1 relative">
                                <i class="fa-solid fa-plane absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-gray-400 bg-white px-1" style="transform: translate(-50%, -50%) rotate(180deg);"></i>
                            </div>
                        </div>
                        <div>
                            <div class="text-2xl font-black text-gray-800">20:40</div>
                            <div class="text-xs text-gray-500">TSA 松山</div>
                        </div>
                    </div>
                     <div class="mt-3 text-xs text-gray-400 border-t pt-2">2026/04/04 (Sat) · 經濟艙</div>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-gray-800 pl-2 border-l-4 border-sakura">住宿資訊</h3>
                <div v-for="hotel in hotels" :key="hotel.name" class="bg-white p-4 rounded-xl shadow-sm flex items-start gap-3">
                    <div class="bg-sakura/20 w-10 h-10 rounded-full flex items-center justify-center text-sakura-dark flex-shrink-0">
                        <i class="fa-solid fa-bed"></i>
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-gray-800 text-sm">{{ hotel.name }}</h4>
                        <p class="text-xs text-gray-500 mt-1"><i class="fa-solid fa-location-dot mr-1"></i>{{ hotel.address }}</p>
                        <div class="mt-2 flex gap-2">
                            <a :href="hotel.mapLink" target="_blank" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1 rounded-full transition"><i class="fa-solid fa-location-arrow mr-1"></i>導航</a>
                            <a href="#" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1 rounded-full transition"><i class="fa-solid fa-phone mr-1"></i>電話</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end justify-center sm:items-center bg-black/50 p-4" @click.self="closeModal">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl relative animate-slide-up">
            <h3 class="text-xl font-bold mb-4 text-center">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-500 mb-1">分類</label>
                    <div class="flex gap-2 overflow-x-auto pb-2">
                        <button v-for="cat in categories" :key="cat.value" 
                            @click="form.category = cat.value"
                            :class="['px-3 py-1 rounded-full text-xs whitespace-nowrap border transition', 
                            form.category === cat.value ? 'bg-sakura text-white border-sakura' : 'bg-white text-gray-500 border-gray-200']">
                            {{ cat.label }}
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">名稱</label>
                    <input v-model="form.name" type="text" class="w-full bg-gray-50 p-3 rounded-lg outline-none focus:ring-1 ring-sakura">
                </div>
                <div class="flex gap-3">
                    <div class="flex-1">
                         <label class="block text-xs text-gray-500 mb-1">時間</label>
                         <input v-model="form.time" type="time" class="w-full bg-gray-50 p-3 rounded-lg outline-none">
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 mb-1">交通時間(分)</label>
                        <input v-model="form.travelTime" type="text" placeholder="如: 步行 10m" class="w-full bg-gray-50 p-3 rounded-lg outline-none">
                   </div>
                </div>
                <div v-if="form.category === 'attraction'">
                    <label class="block text-xs text-gray-500 mb-1">門票資訊</label>
                    <input v-model="form.ticket" type="text" class="w-full bg-gray-50 p-3 rounded-lg outline-none">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">備註 / Google Map 連結</label>
                    <textarea v-model="form.note" rows="2" class="w-full bg-gray-50 p-3 rounded-lg outline-none"></textarea>
                </div>
            </div>

            <div class="mt-6 flex gap-3">
                <button v-if="isEditing" @click="deleteItem" class="flex-1 bg-red-100 text-red-500 py-3 rounded-xl font-bold">刪除</button>
                <button @click="saveItem" class="flex-1 bg-sakura text-white py-3 rounded-xl font-bold shadow-lg shadow-pink-200">
                    {{ isEditing ? '儲存變更' : '確認新增' }}
                </button>
            </div>
        </div>
    </div>
    
    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4" @click.self="showExpenseModal = false">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl animate-slide-up">
            <h3 class="text-xl font-bold mb-4">記帳</h3>
            <div class="space-y-3">
                 <input v-model="expenseForm.name" placeholder="項目名稱" class="w-full bg-gray-50 p-3 rounded-lg">
                 <input v-model="expenseForm.amount" type="number" placeholder="金額 (日幣)" class="w-full bg-gray-50 p-3 rounded-lg">
                 <div class="flex gap-2">
                     <select v-model="expenseForm.category" class="flex-1 bg-gray-50 p-3 rounded-lg">
                         <option value="food">飲食</option>
                         <option value="transport">交通</option>
                         <option value="shopping">購物</option>
                         <option value="hotel">住宿</option>
                         <option value="other">其他</option>
                     </select>
                     <select v-model="expenseForm.payment" class="flex-1 bg-gray-50 p-3 rounded-lg">
                         <option value="現金">現金</option>
                         <option value="信用卡">信用卡</option>
                     </select>
                 </div>
                 <button @click="addExpense" class="w-full bg-yellow-400 text-white py-3 rounded-xl font-bold mt-2">儲存</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentTab: 'itinerary',
                selectedDayIndex: 0,
                days: [], 
                // 預設天氣狀態 (會被 updateWeather 覆蓋)
                weather: { 
                    icon: 'fa-solid fa-sun', 
                    color: 'text-orange-400', 
                    temp: 18, 
                    feelsLike: 16, 
                    desc: '晴朗',
                    location: '東京' 
                },
                showModal: false,
                showExpenseModal: false,
                showShoppingModal: false,
                isEditing: false,
                editingId: null,
                calcJPY: 1000,
                
                form: { category: 'attraction', name: '', time: '', ticket: '', note: '', travelTime: '', location: '' },
                expenseForm: { name: '', amount: '', category: 'food', payment: '現金' },

                categories: [
                    { label: '景點', value: 'attraction' },
                    { label: '美食', value: 'food' },
                    { label: '購物', value: 'shopping' },
                    { label: '住宿', value: 'hotel' },
                    { label: '交通', value: 'transport' },
                    { label: '航班', value: 'flight' }
                ],
                itineraryData: {},
                expenses: [],
                shoppingList: [
                    { id: 1, name: '招財貓 (開運谷中堂)', price: 3000, bought: false, image: null },
                ],
                hotels: [
                    { name: '秋葉原雷姆飯店', address: '東京都千代田区神田佐久間町1-6-5', mapLink: 'https://goo.gl/maps/example' },
                    { name: '東京灣大倉酒店 (Hotel Okura Tokyo Bay)', address: '千葉県浦安市舞浜1-8', mapLink: 'https://maps.app.goo.gl/hotelokurabayeample' },
                    { name: '名古屋站前APA飯店 (APA Hotel Nagoya Ekimae)', address: '愛知県名古屋市中村区名駅4-19-12', mapLink: 'https://maps.app.goo.gl/apanagoyaekimaeexample' },
                    { name: '名古屋三井花園飯店', address: '愛知県名古屋市中村区', mapLink: 'https://goo.gl/maps/example' },
                    { name: 'Sotetsu Fresa Inn大門站', address: '東京都港区芝大門', mapLink: 'https://goo.gl/maps/example' }
                ]
            }
        },
        computed: {
            currentDateKey() {
                return this.days[this.selectedDayIndex]?.fullDate;
            },
            currentDayItinerary() {
                return this.itineraryData[this.currentDateKey] || [];
            },
            totalExpenseTWD() {
                return Math.round(this.expenses.reduce((sum, item) => sum + item.amount, 0) * 0.215);
            },
            expenseStats() {
                const total = this.expenses.length;
                if(total === 0) return { cash: 0, card: 0 };
                const cash = this.expenses.filter(e => e.payment === '現金').length;
                return {
                    cash: Math.round((cash/total)*100),
                    card: 100 - Math.round((cash/total)*100)
                };
            },
            calculatedTWD() {
                return Math.round(this.calcJPY * 0.215).toLocaleString();
            }
        },
        mounted() {
            this.generateDays();
            this.initItineraryData();
            this.initSortable();
            this.updateWeather(); // 初始化第一天天氣
        },
        methods: {
            generateDays() {
                // Update year to 2026
                const start = new Date('2026-03-21');
                const end = new Date('2026-04-04');
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                
                let current = start;
                while (current <= end) {
                    const month = current.getMonth() + 1;
                    const date = current.getDate();
                    const dayStr = `${month}/${date < 10 ? '0' + date : date}`;
                    const fullDateStr = `2026-${month < 10 ? '0' + month : month}-${date < 10 ? '0' + date : date}`;
                    
                    this.days.push({
                        weekday: dayNames[current.getDay()],
                        date: dayStr,
                        fullDate: fullDateStr
                    });
                    current.setDate(current.getDate() + 1);
                }
            },
            // 模擬天氣抓取邏輯
            updateWeather() {
                // 1. 判斷地點 (根據日期)
                const currentDay = this.days[this.selectedDayIndex];
                let location = '東京';
                
                // 3/25 - 3/29 在名古屋
                const date = currentDay.date; // "3/25"
                const [m, d] = date.split('/').map(Number);
                
                if (m === 3 && d >= 25 && d <= 29) {
                    location = '名古屋';
                }

                // 2. 模擬春天天氣數據 (因為是 2026 年，無法抓即時)
                // 這裡使用隨機但符合季節的邏輯
                const seed = this.selectedDayIndex * 13; // 偽隨機種子
                const types = [
                    { type: 'sunny', icon: 'fa-solid fa-sun', color: 'text-orange-400', desc: '晴朗' },
                    { type: 'cloudy', icon: 'fa-solid fa-cloud-sun', color: 'text-yellow-400', desc: '多雲時晴' },
                    { type: 'rain', icon: 'fa-solid fa-cloud-rain', color: 'text-blue-400', desc: '小雨' },
                    { type: 'cloud', icon: 'fa-solid fa-cloud', color: 'text-gray-400', desc: '陰天' }
                ];
                
                // 讓晴天和多雲機率較高
                let typeIndex = (seed % 10); 
                let selectedType;
                if(typeIndex < 4) selectedType = types[0]; // 40% Sunny
                else if(typeIndex < 7) selectedType = types[1]; // 30% Cloudy Sun
                else if(typeIndex < 9) selectedType = types[3]; // 20% Cloud
                else selectedType = types[2]; // 10% Rain

                // 溫度範圍 12 - 22 度
                const baseTemp = 12 + (seed % 10);
                const feelsLike = baseTemp - (selectedType.type === 'rain' ? 2 : 0);

                this.weather = {
                    icon: selectedType.icon,
                    color: selectedType.color,
                    temp: baseTemp,
                    feelsLike: feelsLike,
                    desc: selectedType.desc,
                    location: location
                };
            },
            selectDay(index) {
                this.selectedDayIndex = index;
                this.updateWeather(); // 切換日期時更新天氣
            },
            getCategoryColor(cat) {
                const map = { attraction: 'border-sakura', food: 'border-orange-400', shopping: 'border-purple-400', transport: 'border-blue-400', hotel: 'border-indigo-400', flight: 'border-blue-600' };
                return map[cat] || 'border-gray-300';
            },
            getCategoryBg(cat) {
                 const map = { attraction: 'bg-sakura', food: 'bg-orange-400', shopping: 'bg-purple-400', transport: 'bg-blue-400', hotel: 'bg-indigo-400', flight: 'bg-blue-600' };
                return map[cat] || 'bg-gray-300';
            },
            getCategoryIcon(cat) {
                const map = { attraction: 'fa-camera', food: 'fa-utensils', shopping: 'fa-bag-shopping', transport: 'fa-train-subway', hotel: 'fa-bed', flight: 'fa-plane' };
                return `fa-solid ${map[cat]}`;
            },
            getTransportIcon(type) {
                if(type === 'walk') return 'fa-solid fa-person-walking';
                if(type === 'car') return 'fa-solid fa-car';
                return 'fa-solid fa-train-subway';
            },
            getExpenseIcon(cat) {
                 const map = { food: 'fa-utensils', transport: 'fa-train', shopping: 'fa-bag-shopping', hotel: 'fa-bed', other: 'fa-yen-sign' };
                return `fa-solid ${map[cat]}`;
            },
            openGoogleMaps(location) {
                if(!location) location = "Japan"; 
                if(location.startsWith('http')) {
                    window.open(location, '_blank');
                } else {
                    window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
                }
            },
            openAddModal() {
                this.isEditing = false;
                this.resetForm();
                this.showModal = true;
            },
            editItem(item) {
                this.isEditing = true;
                this.editingId = item.id;
                this.form = { ...item };
                this.showModal = true;
            },
            saveItem() {
                const targetArray = this.itineraryData[this.currentDateKey];
                if (!targetArray) this.itineraryData[this.currentDateKey] = [];
                
                if (this.isEditing) {
                    const index = this.itineraryData[this.currentDateKey].findIndex(i => i.id === this.editingId);
                    if (index !== -1) {
                        this.itineraryData[this.currentDateKey][index] = { ...this.form, id: this.editingId };
                    }
                } else {
                    this.itineraryData[this.currentDateKey].push({
                        ...this.form,
                        id: Date.now(),
                        transportType: 'train' 
                    });
                }
                this.closeModal();
            },
            deleteItem() {
                if(confirm("確定要刪除此行程嗎？")) {
                    const index = this.itineraryData[this.currentDateKey].findIndex(i => i.id === this.editingId);
                    if (index !== -1) this.itineraryData[this.currentDateKey].splice(index, 1);
                    this.closeModal();
                }
            },
            closeModal() {
                this.showModal = false;
            },
            resetForm() {
                this.form = { category: 'attraction', name: '', time: '', ticket: '', note: '', travelTime: '', location: '' };
            },
            addExpense() {
                this.expenses.unshift({
                    id: Date.now(),
                    ...this.expenseForm,
                    date: this.days[this.selectedDayIndex].date
                });
                this.showExpenseModal = false;
                this.expenseForm = { name: '', amount: '', category: 'food', payment: '現金' };
            },
            initSortable() {
                this.$nextTick(() => {
                    const el = document.getElementById('itinerary-list');
                    if(el) {
                        new Sortable(el, {
                            animation: 150,
                            handle: '.card',
                            delay: 200, 
                            delayOnTouchOnly: true
                        });
                    }
                });
            },
            initItineraryData() {
                const setData = (dateStr, items) => {
                    this.itineraryData[dateStr] = items;
                };

                // 更新為 2026 年的日期
                setData('2026-03-21', [
                    { id: 101, category: 'flight', isFlight: true, flightCode: 'JL802', depTime: '10:55', arrTime: '14:55', depAirport: 'TPE', arrAirport: 'NRT', duration: '3h', travelTimeFromHotel: '出發' },
                    { id: 102, category: 'hotel', name: '秋葉原雷姆飯店 Check-in', time: '16:00', travelTime: '60m', transportType: 'train', location: 'Remm Akihabara' },
                    { id: 103, category: 'food', name: '秋葉原晚餐', time: '18:00', travelTime: '步行', note: '動漫逛街、挖寶', location: 'Akihabara' }
                ]);

                setData('2026-03-22', [
                    { id: 201, category: 'food', name: '築地市場', time: '09:00', travelTimeFromHotel: '30m', transportType: 'train', note: '吃吃喝喝', location: 'Tsukiji Outer Market' },
                    { id: 202, category: 'attraction', name: '初音演唱會', time: '11:00', travelTime: '50m', transportType: 'train', location: 'LaLa arena TOKYO-BAY', note: '11:00開幕 12:00開始' },
                    { id: 203, category: 'food', name: 'Lalaport 用餐', time: '14:30', travelTime: '步行', location: 'LaLaport Tokyo-Bay' },
                    { id: 204, category: 'attraction', name: '錦糸公園 賞櫻', time: '16:00', travelTime: '30m', transportType: 'train', location: 'Kinshi Park', note: '櫻花 + 晴空塔' }
                ]);
                
                // 3/25 Move to Nagoya
                setData('2026-03-25', [
                    { id: 501, category: 'transport', name: '新幹線 往名古屋', time: '09:30', travelTimeFromHotel: '30m', location: 'Tokyo Station', note: '約 2hrs' },
                    { id: 502, category: 'attraction', name: '山崎川 四季之道', time: '13:00', travelTime: '20m', location: 'Yamazaki River', note: '石川橋〜新瑞橋 散步' },
                    { id: 504, category: 'hotel', name: '名古屋站前APA飯店 Check-in', time: '15:00', location: 'APA Hotel Nagoya Ekimae' }
                ]);
                
                // 3/28 F1
                setData('2026-03-28', [
                    { id: 801, category: 'attraction', name: 'F1 鈴鹿賽道 (排位賽)', time: '10:00', travelTimeFromHotel: '60m', transportType: 'train', location: 'Suzuka Circuit', note: '整天行程' }
                ]);
            }
        }
    }).mount('#app');
</script>
</body>
</html>