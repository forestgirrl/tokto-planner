<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026日本F1櫻花自由行</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    colors: {
                        bg: '#F7F4EB',
                        primary: '#FF9F9F', // 暖粉
                        secondary: '#A8D8B9', // 柔綠
                        accent: '#F4D35E', // 黃色
                        text: '#5A4D41', // 深咖啡色文字
                        card: '#FFFFFF',
                    },
                    boxShadow: {
                        'soft': '4px 4px 0px rgba(90, 77, 65, 0.15)', // 軟陰影
                        'pop': '4px 4px 0px #5A4D41', // 強烈陰影
                        'inner-soft': 'inset 2px 2px 5px rgba(0,0,0,0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F7F4EB;
            /* 點狀背景紋理 */
            background-image: radial-gradient(#E0E5D5 2px, transparent 2px);
            background-size: 20px 20px;
            color: #5A4D41;
            -webkit-tap-highlight-color: transparent;
        }
        /* 隱藏捲軸但保留功能 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* 機票樣式 */
        .ticket-cut {
            position: relative;
        }
        .ticket-cut::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 70%;
            border-bottom: 2px dashed #E5E7EB;
        }
        .ticket-notch {
            position: absolute;
            top: 70%;
            width: 20px;
            height: 20px;
            background-color: #F7F4EB;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <div id="app" class="h-full flex flex-col max-w-md mx-auto bg-bg shadow-2xl relative">
        
        <header class="relative shrink-0 z-10">
            <div class="h-[150px] w-full overflow-hidden relative border-b-4 border-white rounded-b-3xl shadow-soft">
                <img :src="bannerImage" class="w-full h-full object-cover" alt="Banner">
                <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                
                <div class="absolute top-4 right-4 text-right text-white drop-shadow-md">
                    <h1 class="text-lg font-bold tracking-wider">2025 07月</h1>
                    <h2 class="text-sm font-medium">加利利-南法紫戀薰衣草13日</h2>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto overflow-x-hidden no-scrollbar pb-24 px-4 pt-4">
            
            <div v-if="currentTab === 'schedule'" class="space-y-6">
                
                <div class="flex space-x-3 overflow-x-auto no-scrollbar py-2 sticky top-0 z-20 bg-bg/95 backdrop-blur-sm -mx-4 px-4">
                    <button 
                        v-for="(day, index) in days" 
                        :key="index"
                        @click="selectedDayIndex = index"
                        :class="['flex-shrink-0 px-4 py-2 rounded-2xl border-2 transition-all duration-200 shadow-soft', 
                                 selectedDayIndex === index ? 'bg-primary border-primary text-white transform -translate-y-1' : 'bg-white border-white text-text']"
                    >
                        <div class="text-xs opacity-80">{{ day.date.split(' ')[0] }}</div>
                        <div class="font-bold text-lg">{{ day.date.split(' ')[1] }}</div>
                    </button>
                </div>

                <div class="bg-blue-50 rounded-2xl p-4 shadow-soft border-2 border-white flex items-center justify-between">
                    <div>
                        <div class="text-xs text-gray-500 mb-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ days[selectedDayIndex].location }}</div>
                        <div class="flex items-end gap-2">
                            <span class="text-3xl font-bold text-gray-700">{{ days[selectedDayIndex].weather.temp }}°</span>
                            <span class="text-xs text-gray-500 mb-1">體感 {{ days[selectedDayIndex].weather.feelsLike }}°</span>
                        </div>
                    </div>
                    <div class="text-4xl text-yellow-400">
                        <i :class="getWeatherIcon(days[selectedDayIndex].weather.type)"></i>
                    </div>
                </div>

                <div class="relative pl-4 space-y-0">
                    <div class="absolute left-[27px] top-4 bottom-0 w-0.5 bg-gray-300 border-l-2 border-dashed border-gray-300 z-0"></div>

                    <div v-for="(event, eIndex) in days[selectedDayIndex].events" :key="event.id" class="relative z-10 group">
                        
                        <div v-if="eIndex > 0 || (eIndex === 0 && days[selectedDayIndex].prevStay)" class="ml-10 mb-4 flex items-center text-xs text-gray-500 bg-white/60 py-1 px-3 rounded-full w-max shadow-sm border border-white">
                            <i :class="[event.transportType === 'walk' ? 'fas fa-walking' : 'fas fa-bus', 'mr-2 text-primary']"></i>
                            <span>{{ event.transportTime }} min</span>
                        </div>

                        <div @click="openEventModal(event)" 
                             class="flex gap-3 mb-6 cursor-pointer active:scale-95 transition-transform duration-200">
                            
                            <div class="flex-shrink-0 w-14 text-right pt-2">
                                <span class="block font-bold text-sm text-gray-600">{{ event.time }}</span>
                            </div>

                            <div class="absolute left-[21px] mt-3 w-3.5 h-3.5 rounded-full border-2 border-white shadow-sm" 
                                 :style="{ backgroundColor: getCategoryColor(event.category) }"></div>

                            <div :class="['flex-1 p-3 rounded-2xl shadow-soft border-2 border-white bg-white relative overflow-hidden', event.category === 'flight' ? 'bg-blue-50 border-blue-100' : '']">
                                
                                <div v-if="event.category === 'flight'" class="flex flex-col gap-2">
                                    <div class="flex justify-between items-center border-b border-blue-200 pb-2">
                                        <span class="text-xs font-bold text-blue-500">FLIGHT INFO</span>
                                        <i class="fas fa-plane text-blue-300"></i>
                                    </div>
                                    <div class="font-bold text-lg text-gray-700">{{ event.name }}</div>
                                    <div class="text-sm text-gray-500">{{ event.note }}</div>
                                </div>

                                <div v-else class="flex justify-between">
                                    <div class="flex-1 pr-2">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="px-2 py-0.5 rounded-md text-[10px] text-white font-bold" :style="{ backgroundColor: getCategoryColor(event.category) }">
                                                {{ getCategoryName(event.category) }}
                                            </span>
                                            <span v-if="event.tickets" class="text-[10px] text-gray-400 bg-gray-100 px-1 rounded"><i class="fas fa-ticket-alt mr-1"></i>門票</span>
                                        </div>
                                        <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1">{{ event.name }}</h3>
                                        <p v-if="event.hours" class="text-xs text-gray-400 mb-1"><i class="far fa-clock mr-1"></i>{{ event.hours }}</p>
                                        <p class="text-xs text-gray-500 line-clamp-2">{{ event.note }}</p>
                                    </div>
                                    
                                    <div v-if="event.photo" class="w-16 h-16 rounded-xl overflow-hidden shadow-inner flex-shrink-0 bg-gray-100 border border-gray-100">
                                        <img :src="event.photo" class="w-full h-full object-cover">
                                    </div>
                                    <div v-else class="w-16 h-16 rounded-xl flex items-center justify-center bg-gray-50 border border-dashed border-gray-300 text-gray-300 flex-shrink-0">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                </div>

                                <a :href="'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent(event.name)" 
                                   @click.stop
                                   target="_blank"
                                   class="absolute bottom-2 right-2 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white shadow-md active:scale-90 transition-transform">
                                    <i class="fas fa-location-arrow text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="h-10"></div>
            </div>

            <div v-else-if="currentTab === 'bookings'" class="space-y-4">
                <h2 class="text-xl font-bold ml-1 mb-2 text-text">我的票券夾</h2>
                
                <div class="bg-white rounded-2xl shadow-soft border-l-8 border-primary overflow-hidden">
                    <div class="p-4 border-b border-dashed border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-2xl">TPE</span>
                            <i class="fas fa-plane text-gray-300"></i>
                            <span class="font-bold text-2xl">CDG</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>23:30, 7/6</span>
                            <span>07:55, 7/7</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 flex justify-between items-center">
                        <span class="font-bold text-gray-700">BR-087 長榮航空</span>
                        <span class="bg-primary/20 text-primary px-2 py-1 rounded text-xs font-bold">已確認</span>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-0 shadow-soft overflow-hidden">
                    <div class="h-32 bg-gray-200 relative">
                        <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60" class="w-full h-full object-cover">
                        <div class="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
                            <i class="fas fa-star text-yellow-400 mr-1"></i>5.0
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg">Le Negresco</h3>
                        <p class="text-xs text-gray-500 mb-3"><i class="fas fa-map-pin mr-1"></i>37 Prom. des Anglais, Nice</p>
                        <div class="flex gap-4 text-sm">
                            <div>
                                <span class="block text-xs text-gray-400">Check-in</span>
                                <span class="font-bold">15:00</span>
                            </div>
                            <div>
                                <span class="block text-xs text-gray-400">Check-out</span>
                                <span class="font-bold">11:00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-4 shadow-soft flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-500 flex items-center justify-center">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div>
                            <div class="font-bold text-sm">凡爾登峽谷遊船</div>
                            <div class="text-xs text-gray-500">電子憑證 PDF</div>
                        </div>
                    </div>
                    <button class="text-gray-400 hover:text-primary"><i class="fas fa-download"></i></button>
                </div>
            </div>

            <div v-else-if="currentTab === 'expense'" class="space-y-6">
                <div class="bg-white rounded-3xl p-6 shadow-pop text-center relative overflow-hidden">
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-yellow-100 rounded-full z-0"></div>
                    <div class="relative z-10">
                        <p class="text-xs text-gray-500 mb-1">總支出 (TWD)</p>
                        <h2 class="text-4xl font-bold text-gray-800 tracking-tight">{{ totalExpenseTWD.toLocaleString() }}</h2>
                        <div class="mt-2 text-sm text-gray-400">
                            ≈ € {{ (totalExpenseTWD / exchangeRate).toFixed(2) }}
                        </div>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button @click="showAddExpense = true" class="flex-1 bg-secondary text-white font-bold py-3 rounded-xl shadow-soft active:scale-95 transition-transform">
                        <i class="fas fa-plus mr-2"></i>新增記帳
                    </button>
                    <button @click="resetExpenses" class="w-12 bg-white text-red-400 rounded-xl shadow-soft flex items-center justify-center active:scale-95">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>

                <div class="space-y-3">
                    <div v-for="(exp, index) in expenses" :key="index" class="bg-white rounded-xl p-3 flex justify-between items-center shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs">
                                <i :class="getExpenseIcon(exp.category)"></i>
                            </div>
                            <div>
                                <div class="font-bold text-sm">{{ exp.note }}</div>
                                <div class="text-[10px] text-gray-400">{{ exp.date }}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-700">${{ exp.amount }}</div>
                            <button @click="deleteExpense(index)" class="text-[10px] text-red-300">刪除</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <button v-if="currentTab === 'schedule'" 
                @click="openAddEventModal"
                class="absolute bottom-24 right-6 w-14 h-14 bg-primary text-white rounded-full shadow-pop flex items-center justify-center text-2xl active:scale-90 transition-transform z-30 border-2 border-white">
            <i class="fas fa-plus"></i>
        </button>

        <nav class="h-20 bg-white rounded-t-3xl shadow-[0_-4px_20px_rgba(0,0,0,0.05)] flex justify-around items-center px-6 relative z-40">
            <button @click="currentTab = 'schedule'" :class="['flex flex-col items-center gap-1 transition-all', currentTab === 'schedule' ? 'text-primary scale-110' : 'text-gray-300']">
                <i class="fas fa-map-marked-alt text-xl"></i>
                <span class="text-[10px] font-bold">行程</span>
            </button>
            <button @click="currentTab = 'bookings'" :class="['flex flex-col items-center gap-1 transition-all', currentTab === 'bookings' ? 'text-primary scale-110' : 'text-gray-300']">
                <i class="fas fa-ticket-alt text-xl"></i>
                <span class="text-[10px] font-bold">預訂</span>
            </button>
            <button @click="currentTab = 'expense'" :class="['flex flex-col items-center gap-1 transition-all', currentTab === 'expense' ? 'text-primary scale-110' : 'text-gray-300']">
                <i class="fas fa-wallet text-xl"></i>
                <span class="text-[10px] font-bold">記帳</span>
            </button>
        </nav>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm pointer-events-auto" @click="closeModal"></div>
            <div class="bg-[#F7F4EB] w-full max-w-md h-[85vh] sm:h-auto rounded-t-3xl sm:rounded-3xl p-6 relative pointer-events-auto shadow-2xl flex flex-col">
                <div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
                
                <h3 class="text-xl font-bold mb-4 text-center">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
                
                <div class="flex-1 overflow-y-auto no-scrollbar space-y-4 px-1">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">名稱</label>
                        <input v-model="editingEvent.name" type="text" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft focus:ring-2 focus:ring-primary outline-none">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">時間</label>
                            <input v-model="editingEvent.time" type="time" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">類別</label>
                            <select v-model="editingEvent.category" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft text-sm">
                                <option value="sight">景點</option>
                                <option value="food">美食</option>
                                <option value="hotel">住宿</option>
                                <option value="shop">購物</option>
                                <option value="activity">活動</option>
                                <option value="flight">航班</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">
                            <i class="fas fa-route mr-1"></i>距離上一站交通時間 (分鐘)
                        </label>
                        <div class="flex items-center gap-2">
                            <input v-model="editingEvent.transportTime" type="number" class="w-20 bg-white rounded-xl p-3 border-none shadow-inner-soft">
                            <div class="flex bg-white rounded-xl p-1 shadow-sm">
                                <button @click="editingEvent.transportType = 'walk'" :class="['p-2 rounded-lg transition-colors', editingEvent.transportType === 'walk' ? 'bg-secondary text-white' : 'text-gray-400']"><i class="fas fa-walking"></i></button>
                                <button @click="editingEvent.transportType = 'transit'" :class="['p-2 rounded-lg transition-colors', editingEvent.transportType === 'transit' ? 'bg-secondary text-white' : 'text-gray-400']"><i class="fas fa-bus"></i></button>
                            </div>
                        </div>
                    </div>

                    <div v-if="['sight', 'food', 'shop'].includes(editingEvent.category)">
                        <label class="block text-xs font-bold text-gray-500 mb-1">營業時間</label>
                        <input v-model="editingEvent.hours" type="text" placeholder="例如: 09:00 - 18:00" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft">
                    </div>

                    <div v-if="editingEvent.category === 'sight'">
                        <label class="block text-xs font-bold text-gray-500 mb-1">門票資訊</label>
                        <input v-model="editingEvent.tickets" type="text" placeholder="票價或預約號碼" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">特色 & 備註</label>
                        <textarea v-model="editingEvent.note" rows="3" class="w-full bg-white rounded-xl p-3 border-none shadow-inner-soft"></textarea>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">照片</label>
                        <div class="flex items-center gap-4">
                            <div v-if="editingEvent.photo" class="w-20 h-20 rounded-xl overflow-hidden relative group">
                                <img :src="editingEvent.photo" class="w-full h-full object-cover">
                                <button @click="editingEvent.photo = null" class="absolute inset-0 bg-black/50 text-white opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity"><i class="fas fa-trash"></i></button>
                            </div>
                            <label class="w-20 h-20 bg-white rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 cursor-pointer hover:border-primary hover:text-primary transition-colors">
                                <i class="fas fa-plus"></i>
                                <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mt-4 flex gap-3">
                    <button v-if="isEditing" @click="deleteEvent" class="px-4 py-3 rounded-xl bg-red-100 text-red-500 font-bold"><i class="fas fa-trash"></i></button>
                    <button @click="saveEvent" class="flex-1 bg-primary text-white font-bold py-3 rounded-xl shadow-soft active:scale-95">確認儲存</button>
                </div>
            </div>
        </div>

        <div v-if="showAddExpense" class="fixed inset-0 z-50 flex items-end justify-center pointer-events-none">
            <div class="absolute inset-0 bg-black/40 pointer-events-auto" @click="showAddExpense = false"></div>
            <div class="bg-white w-full max-w-md rounded-t-3xl p-6 pointer-events-auto shadow-2xl">
                <h3 class="font-bold text-center mb-4">記一筆</h3>
                <input v-model.number="newExpense.amount" type="number" placeholder="金額" class="w-full text-3xl font-bold text-center p-4 border-b-2 border-primary outline-none mb-4">
                <input v-model="newExpense.note" type="text" placeholder="項目名稱 (午餐、紀念品...)" class="w-full bg-gray-50 p-3 rounded-xl mb-4">
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button v-for="cat in ['food','shop','transport','other']" :key="cat" @click="newExpense.category = cat" 
                           :class="['p-2 rounded-lg text-center text-xs', newExpense.category === cat ? 'bg-primary text-white' : 'bg-gray-100']">
                        <i :class="getExpenseIcon(cat)" class="mb-1 block text-lg"></i>
                    </button>
                </div>
                <button @click="addExpense" class="w-full bg-primary text-white font-bold py-3 rounded-xl shadow-soft">新增</button>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                // --- State ---
                const currentTab = ref('schedule');
                const selectedDayIndex = ref(0);
                const showModal = ref(false);
                const showAddExpense = ref(false);
                const isEditing = ref(false);
                const bannerImage = ref('f1cat.jpg'); // 預設圖片路徑，若無則顯示破圖或你可以改用網址
                
                // 為了demo，如果找不到f1cat，用一個unsplash圖片代替
                const imgCheck = new Image();
                imgCheck.onerror = () => { bannerImage.value = 'https://images.unsplash.com/photo-1549480017-d76466a4b7e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'; };
                imgCheck.src = 'f1cat.jpg';


                // --- Mock Data: Days ---
                const days = ref([
                    {
                        date: '7/6 (日)',
                        location: '桃園 -> 巴黎',
                        weather: { type: 'cloud', temp: 26, feelsLike: 28 },
                        prevStay: null,
                        events: [
                            { id: 1, time: '23:30', name: '長榮航空 BR087', category: 'flight', note: '桃園 T2 -> 戴高樂 T1, 14hrs', transportTime: 0, transportType: 'transit', photo: null }
                        ]
                    },
                    {
                        date: '7/7 (一)',
                        location: '尼斯',
                        weather: { type: 'sun', temp: 28, feelsLike: 30 },
                        prevStay: null, // Day 1 is flight, so no hotel transport logic
                        events: [
                            { id: 2, time: '07:55', name: '抵達巴黎戴高樂', category: 'activity', note: '入境、轉機', transportTime: 0, transportType: 'walk' },
                            { id: 3, time: '13:40', name: '法航 AF7700', category: 'flight', note: '飛往尼斯, 75min', transportTime: 60, transportType: 'transit' },
                            { id: 4, time: '15:15', name: '抵達尼斯機場', category: 'activity', note: '取車/接送', transportTime: 0, transportType: 'walk' },
                            { id: 5, time: '16:30', name: '聖保羅 de Vence', category: 'sight', hours: '10:00-19:00', tickets: '免費入城', note: '山城藝術村，必逛畫廊', transportTime: 45, transportType: 'transit', photo: 'https://images.unsplash.com/photo-1598621457813-888a7c2e3992?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80' },
                            { id: 6, time: '19:00', name: 'Le Negresco', category: 'hotel', hours: 'Check-in 15:00', note: '尼斯百年傳奇飯店', transportTime: 30, transportType: 'transit', photo: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80' },
                            { id: 7, time: '20:00', name: '蔚藍海岸料理', category: 'food', hours: '18:00-22:00', note: '海鮮拼盤、白酒', transportTime: 5, transportType: 'walk' }
                        ]
                    },
                    {
                        date: '7/8 (二)',
                        location: '凡爾登峽谷',
                        weather: { type: 'sun', temp: 30, feelsLike: 32 },
                        prevStay: 'Le Negresco',
                        events: [
                            { id: 8, time: '09:00', name: '出發前往峽谷', category: 'activity', note: '自駕欣賞沿途風景', transportTime: 0, transportType: 'transit' },
                            { id: 9, time: '11:30', name: '凡爾登峽谷', category: 'sight', note: '歐洲大峽谷，租船遊湖', transportTime: 150, transportType: 'transit', photo: 'https://images.unsplash.com/photo-1588601831873-1006eb49b385?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80' },
                             { id: 10, time: '15:00', name: '瓦倫索薰衣草田', category: 'sight', note: '盛開期！拍照熱點', transportTime: 40, transportType: 'transit' }
                        ]
                    }
                ]);

                // --- Mock Data: Expenses ---
                const expenses = ref([
                    { amount: 3500, category: 'food', note: '尼斯晚餐', date: '7/7' },
                    { amount: 1200, category: 'transport', note: '機場接送小費', date: '7/7' }
                ]);
                const newExpense = ref({ amount: '', note: '', category: 'food' });
                const exchangeRate = 35; // TWD to EUR rough est.

                // --- Temp Editing State ---
                const editingEvent = ref({});

                // --- Helpers ---
                const getCategoryColor = (cat) => {
                    const colors = {
                        sight: '#F4D35E', // Yellow
                        food: '#FF9F9F',  // Pink
                        hotel: '#A8D8B9', // Green
                        shop: '#B6A6CA',  // Purple
                        activity: '#93C5FD', // Blue
                        flight: '#60A5FA' // Darker Blue
                    };
                    return colors[cat] || '#ccc';
                };

                const getCategoryName = (cat) => {
                    const names = { sight: '景點', food: '美食', hotel: '住宿', shop: '購物', activity: '活動', flight: '航班' };
                    return names[cat] || '其他';
                };

                const getWeatherIcon = (type) => {
                    if(type === 'sun') return 'fas fa-sun';
                    if(type === 'cloud') return 'fas fa-cloud';
                    if(type === 'rain') return 'fas fa-cloud-rain';
                    return 'fas fa-sun';
                };

                const getExpenseIcon = (cat) => {
                    const icons = { food: 'fas fa-utensils', shop: 'fas fa-shopping-bag', transport: 'fas fa-bus', other: 'fas fa-ellipsis-h' };
                    return icons[cat] || 'fas fa-coins';
                };

                // --- Computed ---
                const totalExpenseTWD = computed(() => {
                    return expenses.value.reduce((sum, item) => sum + item.amount, 0);
                });

                // --- Actions ---
                const openEventModal = (event) => {
                    isEditing.value = true;
                    // Deep copy to avoid direct mutation before save
                    editingEvent.value = JSON.parse(JSON.stringify(event));
                    showModal.value = true;
                };

                const openAddEventModal = () => {
                    isEditing.value = false;
                    editingEvent.value = {
                        id: Date.now(),
                        time: '12:00',
                        name: '',
                        category: 'sight',
                        note: '',
                        transportTime: 15,
                        transportType: 'walk',
                        photo: null
                    };
                    showModal.value = true;
                };

                const closeModal = () => {
                    showModal.value = false;
                    editingEvent.value = {};
                };

                const saveEvent = () => {
                    const currentDayEvents = days.value[selectedDayIndex.value].events;
                    
                    if (isEditing.value) {
                        const index = currentDayEvents.findIndex(e => e.id === editingEvent.value.id);
                        if (index !== -1) {
                            currentDayEvents[index] = editingEvent.value;
                        }
                    } else {
                        currentDayEvents.push(editingEvent.value);
                    }
                    // Sort by time
                    currentDayEvents.sort((a, b) => a.time.localeCompare(b.time));
                    closeModal();
                    saveToLocalStorage();
                };

                const deleteEvent = () => {
                    if(!confirm('確定要刪除此行程嗎？')) return;
                    const currentDayEvents = days.value[selectedDayIndex.value].events;
                    const index = currentDayEvents.findIndex(e => e.id === editingEvent.value.id);
                    if(index !== -1) currentDayEvents.splice(index, 1);
                    closeModal();
                    saveToLocalStorage();
                };

                const addExpense = () => {
                    if(!newExpense.value.amount) return;
                    expenses.value.unshift({
                        amount: newExpense.value.amount,
                        category: newExpense.value.category,
                        note: newExpense.value.note || '未分類',
                        date: new Date().getMonth() + 1 + '/' + new Date().getDate()
                    });
                    newExpense.value = { amount: '', note: '', category: 'food' };
                    showAddExpense.value = false;
                    saveToLocalStorage();
                };

                const deleteExpense = (index) => {
                    if(confirm('刪除這筆記帳？')) {
                        expenses.value.splice(index, 1);
                        saveToLocalStorage();
                    }
                };

                const resetExpenses = () => {
                     if(confirm('清空所有記帳資料？')) {
                        expenses.value = [];
                        saveToLocalStorage();
                     }
                };

                // Handle Image Upload (Convert to Base64 for local storage demo)
                const handleImageUpload = (e) => {
                    const file = e.target.files[0];
                    if(file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            editingEvent.value.photo = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                };

                // Persistence
                const saveToLocalStorage = () => {
                    localStorage.setItem('travelApp_days', JSON.stringify(days.value));
                    localStorage.setItem('travelApp_expenses', JSON.stringify(expenses.value));
                };

                onMounted(() => {
                    const savedDays = localStorage.getItem('travelApp_days');
                    const savedExpenses = localStorage.getItem('travelApp_expenses');
                    if(savedDays) days.value = JSON.parse(savedDays);
                    if(savedExpenses) expenses.value = JSON.parse(savedExpenses);
                });

                return {
                    currentTab,
                    selectedDayIndex,
                    days,
                    expenses,
                    showModal,
                    showAddExpense,
                    isEditing,
                    editingEvent,
                    newExpense,
                    totalExpenseTWD,
                    exchangeRate,
                    bannerImage,
                    getCategoryColor,
                    getCategoryName,
                    getWeatherIcon,
                    getExpenseIcon,
                    openEventModal,
                    openAddEventModal,
                    closeModal,
                    saveEvent,
                    deleteEvent,
                    addExpense,
                    deleteExpense,
                    resetExpenses,
                    handleImageUpload
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
