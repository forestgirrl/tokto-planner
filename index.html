<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ±äº¬8Dè‡ªç”±è¡Œ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#F7F4EB',
                        primary: '#FF8E8E',
                        secondary: '#A6B999',
                        text: '#5A544B',
                        card: '#FFFFFF',
                        shadow: '#E0E5D5',
                        danger: '#EF4444',
                        accent: '#E6C683'
                    },
                    fontFamily: {
                        sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '4px 4px 0px #E0E5D5',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F7F4EB;
            color: #5A544B;
            background-image: radial-gradient(#E0E5D5 1px, transparent 1px);
            background-size: 20px 20px;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .swipe-item { transition: transform 0.1s ease-out; }
        .swipe-reset { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .photo-upload-box {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='6%2c 6' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        .no-select { user-select: none; -webkit-user-select: none; }
        /* Animation */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
    </style>
</head>
<body class="antialiased">

<div id="app" class="pb-24 min-h-screen relative overflow-hidden">

    <header class="relative w-full z-10">
        <div class="h-[180px] w-full overflow-hidden relative">
            <img :src="headerImage" class="w-full h-full object-cover object-center" @error="handleImgError">
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
            <div class="absolute top-6 right-6 text-right text-white drop-shadow-md">
                <h1 class="text-2xl font-extrabold tracking-wide">2026æ±äº¬8Dè‡ªç”±è¡Œ</h1>
                <p class="text-sm font-bold opacity-90">01/03 - 01/11</p>
            </div>
        </div>
    </header>

    <main class="relative -mt-8 bg-[#F7F4EB] rounded-t-[30px] z-20 min-h-screen px-4 pt-6 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        
        <div class="flex justify-between items-center mb-6 overflow-x-auto hide-scrollbar gap-3 p-2">
            <button v-for="tab in tabs" :key="tab.id" 
                @click="currentTab = tab.id"
                :class="['flex-1 py-3 px-1 min-w-[70px] rounded-2xl flex flex-col items-center justify-center transition-all duration-200 border-2 relative', 
                currentTab === tab.id ? 'bg-white border-primary shadow-soft text-primary -translate-y-1 z-10' : 'bg-white/60 border-transparent text-gray-400']">
                <i :class="[tab.icon, 'text-xl mb-1']"></i>
                <span class="text-xs font-bold">{{ tab.name }}</span>
            </button>
        </div>

        <div v-if="currentTab === 'schedule'" class="animate-fade-in">
            <div class="flex space-x-3 overflow-x-auto hide-scrollbar mb-6 py-2 px-1">
                <div v-for="(day, index) in scheduleDays" :key="index"
                     @click="selectedDayIndex = index"
                     :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl border-2 cursor-pointer transition-all',
                     selectedDayIndex === index ? 'bg-primary border-primary text-white shadow-soft transform -translate-y-1' : 'bg-white border-transparent text-gray-400']">
                    <span class="text-xs font-bold uppercase">{{ day.weekday }}</span>
                    <span class="text-2xl font-extrabold">{{ day.date }}</span>
                </div>
            </div>

            <div class="bg-gradient-to-r from-[#AEC0F0] to-[#CFDEF3] rounded-3xl p-4 mb-8 flex justify-between items-center shadow-soft text-white relative overflow-hidden">
                <div class="z-10">
                    <div class="text-sm font-bold opacity-90 flex items-center gap-1"><i class="fa-solid fa-location-dot"></i> Tokyo</div>
                    <div class="text-4xl font-extrabold mt-1">{{ weatherData.temp }}<span class="text-2xl">Â°C</span></div>
                    <div class="text-xs opacity-80 mt-1">{{ weatherData.desc }}</div>
                </div>
                <div class="z-10 text-5xl opacity-90"><i :class="weatherData.icon"></i></div>
            </div>

            <div class="space-y-6 relative pb-24">
                <div class="absolute left-[26px] top-2 bottom-0 w-0.5 border-l-2 border-dashed border-gray-300 z-0"></div>

                <div v-for="(event, index) in currentDayEvents" :key="event.id" class="relative pl-0 group mb-6">
                    
                    <div v-if="index > 0" class="absolute -top-5 left-12 flex items-center z-0 pointer-events-none">
                         <div class="bg-white/90 px-2 py-0.5 rounded-full text-[10px] text-gray-500 border border-gray-200 flex items-center gap-1">
                            <i :class="getTransportIcon(event.transportType)"></i>
                            <span>{{ event.transportTime || '15 min' }}</span>
                         </div>
                    </div>

                    <div class="absolute left-0 top-6 w-14 text-center z-10 bg-[#F7F4EB] py-1">
                        <div class="w-4 h-4 rounded-full border-2 border-white shadow-sm mx-auto mb-1" :style="{ backgroundColor: getCategoryColor(event.category) }"></div>
                        <div class="text-[10px] font-bold text-gray-400 font-mono">{{ event.time }}</div>
                    </div>

                    <div class="relative w-full pl-14 h-32">
                        <div class="absolute inset-y-0 right-0 w-20 bg-danger rounded-2xl flex items-center justify-center text-white z-0" @click="deleteEvent(index)">
                            <div class="flex flex-col items-center">
                                <i class="fa-solid fa-trash-can text-xl mb-1"></i>
                                <span class="text-[10px] font-bold">åˆªé™¤</span>
                            </div>
                        </div>

                        <div :class="['bg-white h-full rounded-2xl p-3 border-2 border-transparent shadow-soft relative z-10 flex gap-3 overflow-hidden no-select active:border-primary/20 cursor-pointer', isSwiping ? 'swipe-item' : 'swipe-reset']"
                             :style="{ transform: `translateX(${event.offsetX || 0}px)` }"
                             @touchstart="touchStart($event, event)"
                             @touchmove="touchMove($event, event)"
                             @touchend="touchEnd($event, event)"
                             @click="handleEventClick(event)"> <div class="flex-1 flex flex-col justify-between">
                                <div>
                                    <div v-if="event.category === 'flight'" class="text-[10px] text-blue-500 font-bold mb-1"><i class="fa-solid fa-plane-departure"></i> èˆªç­</div>
                                    <h3 class="font-bold text-lg leading-tight text-text line-clamp-2">{{ event.title }}</h3>
                                    
                                    <div class="text-xs text-gray-400 mt-1 flex items-center gap-1 cursor-pointer hover:text-blue-500 transition-colors"
                                         @click.stop="openMap(event.location)">
                                        <i class="fa-solid fa-location-dot text-primary text-[10px]"></i> 
                                        <span class="line-clamp-1 underline decoration-dashed">{{ event.location }}</span>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-1 mt-2">
                                     <span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md">
                                        {{ event.category === 'flight' ? event.subTitle : (event.openTime || 'ç‡Ÿæ¥­ä¸­') }}
                                    </span>
                                </div>
                            </div>

                            <div class="w-20 flex-shrink-0 flex flex-col gap-2">
                                <div class="flex-1 photo-upload-box rounded-xl overflow-hidden relative group bg-gray-50 cursor-pointer" 
                                     @click.stop="triggerPhotoUpload(event.id)">
                                    <img v-if="event.photo" :src="event.photo" class="w-full h-full object-cover">
                                    <div v-else class="w-full h-full flex flex-col items-center justify-center text-gray-300">
                                        <i class="fa-solid fa-camera text-lg"></i>
                                    </div>
                                    <input type="file" :id="'file-'+event.id" class="hidden" accept="image/*" @change="(e) => handlePhotoUpload(e, event)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button @click="openEventModal()" class="fixed bottom-24 right-6 w-14 h-14 bg-primary text-white rounded-full shadow-lg flex items-center justify-center text-2xl hover:scale-110 active:scale-90 transition-transform z-30">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>

        <div v-if="currentTab === 'bookings'" class="animate-fade-in space-y-5 pb-24">
            <div class="flex justify-between items-end mb-2">
                <h2 class="text-xl font-bold">ä½å®¿ & èˆªç­</h2>
                <button @click="openBookingModal(null, 'hotel')" class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full font-bold">
                    <i class="fa-solid fa-plus mr-1"></i>æ–°å¢
                </button>
            </div>
            
            <div v-for="(hotel, idx) in bookings.hotels" :key="'h'+hotel.id" 
                 class="bg-white rounded-2xl overflow-hidden shadow-soft relative group transition-transform active:scale-[0.99] cursor-pointer"
                 @click="openBookingModal(hotel, 'hotel')">
                
                <div class="h-40 bg-gray-200 relative cursor-pointer" @click.stop="triggerPhotoUpload('hotel-'+hotel.id)">
                    <img :src="hotel.img" class="w-full h-full object-cover transition-opacity hover:opacity-90" @error="handleImgError">
                    <input type="file" :id="'file-hotel-'+hotel.id" class="hidden" accept="image/*" @change="(e) => handleBookingPhoto(e, hotel)">
                    <div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded-lg text-xs font-bold text-primary shadow-sm flex items-center gap-1">
                        <i class="fa-solid fa-moon"></i> {{ hotel.nights }} æ™š
                    </div>
                    <div class="absolute top-2 right-2 bg-black/30 text-white rounded-full p-1 px-2 text-[10px] backdrop-blur-sm">
                        <i class="fa-solid fa-pen mr-1"></i>ç·¨è¼¯
                    </div>
                </div>
                
                <div class="p-4">
                    <h3 class="font-bold text-lg mb-1 text-gray-800 leading-tight">{{ hotel.name }}</h3>
                    <p class="text-xs text-blue-500 mb-3 cursor-pointer underline decoration-dashed hover:text-blue-600 transition-colors" 
                       @click.stop="openMap(hotel.address)">
                        <i class="fa-solid fa-map-location-dot mr-1"></i>{{ hotel.address }}
                    </p>
                    <div class="flex justify-between text-xs bg-bg p-3 rounded-xl border border-gray-100">
                        <div class="text-center w-1/2">
                            <div class="text-gray-400 scale-90 font-bold mb-0.5">CHECK-IN</div>
                            <div class="font-bold text-base text-gray-700">{{ hotel.checkIn }}</div>
                        </div>
                        <div class="text-center w-1/2 border-l border-gray-300">
                            <div class="text-gray-400 scale-90 font-bold mb-0.5">CHECK-OUT</div>
                            <div class="font-bold text-base text-gray-700">{{ hotel.checkOut }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-for="(flight, idx) in bookings.flights" :key="'f'+flight.id" 
                  class="bg-white rounded-2xl shadow-soft relative overflow-hidden cursor-pointer active:scale-[0.99] transition-transform"
                  @click="openBookingModal(flight, 'flight')">
                 <div class="bg-primary h-3 w-full"></div>
                 <div class="p-5">
                     <div class="flex justify-between items-center mb-4">
                         <div class="text-center"><div class="text-3xl font-black text-text">{{ flight.from }}</div><div class="text-sm font-bold text-primary mt-1">{{ flight.depTime }}</div></div>
                         <div class="flex-1 mx-4 border-b-2 border-dashed border-gray-300 relative text-center"><i class="fa-solid fa-plane text-gray-300 absolute -top-3 left-1/2 transform -translate-x-1/2 bg-white px-1"></i></div>
                         <div class="text-center"><div class="text-3xl font-black text-text">{{ flight.to }}</div><div class="text-sm font-bold text-primary mt-1">{{ flight.arrTime }}</div></div>
                     </div>
                     <div class="flex justify-between text-sm items-end bg-bg p-2 rounded-lg">
                         <div><p class="text-gray-400 text-xs">FLIGHT</p><p class="font-bold">{{ flight.code }}</p></div>
                         <div class="text-right"><p class="text-gray-400 text-xs">DATE</p><p class="font-bold">{{ flight.date }}</p></div>
                     </div>
                 </div>
                 <div class="absolute left-[-10px] top-1/2 w-6 h-6 bg-[#F7F4EB] rounded-full"></div>
                 <div class="absolute right-[-10px] top-1/2 w-6 h-6 bg-[#F7F4EB] rounded-full"></div>
             </div>
        </div>

        <div v-if="currentTab === 'expense'" class="animate-fade-in pb-24">
             <div class="bg-text text-white rounded-3xl p-6 shadow-soft mb-6 relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-sm opacity-70">ç¸½æ”¯å‡º (TWD)</p>
                    <h2 class="text-3xl font-bold mt-1">$ {{ totalExpense.toLocaleString() }}</h2>
                    <div class="mt-4 flex gap-4 text-sm">
                        <div><span class="block opacity-50 text-xs">JPY</span><span class="font-bold">Â¥ {{ totalExpenseJpy.toLocaleString() }}</span></div>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div v-for="(item, index) in expenses" :key="item.id" class="relative w-full h-20 group">
                    <div class="absolute inset-y-0 right-0 w-20 bg-danger rounded-2xl flex items-center justify-center text-white z-0" @click="deleteExpense(index)">
                        <div class="flex flex-col items-center"><i class="fa-solid fa-trash-can text-xl mb-1"></i><span class="text-[10px] font-bold">åˆªé™¤</span></div>
                    </div>
                    <div :class="['absolute inset-0 bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm z-10 no-select cursor-pointer border-2 border-transparent active:border-primary/20', isSwiping ? 'swipe-item' : 'swipe-reset']"
                         :style="{ transform: `translateX(${item.offsetX || 0}px)` }"
                         @touchstart="touchStart($event, item)"
                         @touchmove="touchMove($event, item)"
                         @touchend="touchEnd($event, item)"
                         @click="handleExpenseClick(item)">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-bg flex items-center justify-center text-lg shrink-0">{{ getCategoryIcon(item.category) }}</div>
                            <div><div class="font-bold text-sm">{{ item.title }}</div><div class="text-xs text-gray-400">{{ item.date }}</div></div>
                        </div>
                        <div class="text-right">
                             <div class="font-bold text-text">Â¥{{ item.amount }}</div>
                             <div class="text-xs text-primary/70 font-bold opacity-0 group-hover:opacity-100 transition-opacity">é»æ“Šä¿®æ”¹</div>
                        </div>
                    </div>
                </div>
            </div>
            <button @click="openExpenseModal()" class="fixed bottom-24 right-6 w-14 h-14 bg-accent text-text rounded-full shadow-lg flex items-center justify-center text-2xl hover:scale-110 active:scale-90 transition-transform z-30 font-bold"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div v-if="currentTab === 'planning'" class="animate-fade-in pb-24">
             <div class="flex justify-between items-end mb-4">
                 <h2 class="text-xl font-bold">å¾…è¾¦æ¸…å–®</h2>
                 <button @click="openTodoModal()" class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full font-bold"><i class="fa-solid fa-plus mr-1"></i>æ–°å¢</button>
             </div>
             <div class="space-y-2 mb-8">
                <div v-for="todo in todos" :key="todo.id" class="flex items-center bg-white p-3 rounded-xl shadow-sm group">
                    <div @click="todo.done = !todo.done" :class="['w-5 h-5 rounded-md border-2 mr-3 flex items-center justify-center transition-colors cursor-pointer shrink-0', todo.done ? 'bg-primary border-primary' : 'border-gray-300']">
                        <i v-if="todo.done" class="fa-solid fa-check text-white text-xs"></i>
                    </div>
                    <span @click="openTodoModal(todo)" :class="['font-medium flex-1 cursor-pointer hover:text-primary transition-colors', todo.done ? 'text-gray-400 line-through' : 'text-text']">{{ todo.text }}</span>
                    <i @click="openTodoModal(todo)" class="fa-solid fa-pen text-gray-300 text-xs px-2 cursor-pointer hover:text-primary"></i>
                </div>
             </div>

             <div class="flex justify-between items-end mb-4">
                 <h2 class="text-xl font-bold">è³¼ç‰©æ¸…å–®</h2>
                 <button @click="showShoppingModal = true" class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full font-bold">æ–°å¢ç‰©å“</button>
             </div>
             <div class="grid grid-cols-2 gap-4">
                <div v-for="item in shoppingList" :key="item.id" class="bg-white p-2 rounded-xl shadow-soft relative group">
                    <button @click="removeShoppingItem(item.id)" class="absolute top-1 right-1 bg-red-400 text-white w-6 h-6 rounded-full text-xs z-10 shadow-sm">x</button>
                    <div class="h-28 bg-gray-100 rounded-lg mb-2 relative overflow-hidden">
                        <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex flex-col items-center justify-center text-gray-300"><i class="fa-solid fa-image mb-1"></i><span class="text-[10px]">ç„¡åœ–ç‰‡</span></div>
                    </div>
                    <div class="text-center font-bold text-sm truncate px-1">{{ item.name }}</div>
                </div>
             </div>
        </div>

    </main>

    <div v-if="showAddModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" @click.self="showAddModal = false">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <h3 class="text-xl font-bold mb-4">{{ editingEventId ? 'ä¿®æ”¹è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <div class="space-y-4">
                <input v-model="newEvent.title" placeholder="è¡Œç¨‹åç¨±" class="w-full bg-bg p-3 rounded-xl outline-none focus:ring-2 ring-primary/50">
                <input v-model="newEvent.location" placeholder="åœ°é» (Google Map)" class="w-full bg-bg p-3 rounded-xl outline-none">
                <select v-model="newEvent.category" class="w-full bg-bg p-3 rounded-xl outline-none">
                    <option value="spot">ğŸ“ æ™¯é»</option>
                    <option value="food">ğŸœ ç¾é£Ÿ</option>
                    <option value="shop">ğŸ›ï¸ è³¼ç‰©</option>
                    <option value="hotel">ğŸ¨ ä½å®¿</option>
                    <option value="flight">âœˆï¸ èˆªç­</option>
                </select>
                <div class="flex gap-2">
                    <input type="time" v-model="newEvent.time" class="flex-1 bg-bg p-3 rounded-xl outline-none">
                    <input v-if="newEvent.category !== 'flight'" v-model="newEvent.openTime" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="flex-1 bg-bg p-3 rounded-xl outline-none text-sm">
                </div>
                
                <div class="flex gap-2 pt-2">
                    <button v-if="editingEventId" @click="deleteEventInModal" class="w-1/3 bg-red-100 text-red-500 py-3 rounded-xl font-bold shadow-soft">åˆªé™¤</button>
                    <button @click="saveEvent" :class="[editingEventId ? 'w-2/3' : 'w-full', 'bg-primary text-white py-3 rounded-xl font-bold shadow-lg']">
                        {{ editingEventId ? 'å„²å­˜ä¿®æ”¹' : 'ç¢ºèªæ–°å¢' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showBookingModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" @click.self="showBookingModal = false">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <h3 class="text-xl font-bold mb-4">{{ editingBookingId ? 'ä¿®æ”¹é è¨‚' : 'æ–°å¢é è¨‚' }}</h3>
            <div class="flex gap-2 mb-4">
                <button @click="bookingType='hotel'" :class="['flex-1 py-2 rounded-lg font-bold transition-colors', bookingType==='hotel'?'bg-primary text-white':'bg-bg text-gray-400']">ä½å®¿</button>
                <button @click="bookingType='flight'" :class="['flex-1 py-2 rounded-lg font-bold transition-colors', bookingType==='flight'?'bg-primary text-white':'bg-bg text-gray-400']">æ©Ÿç¥¨</button>
            </div>
            
            <div v-if="bookingType==='hotel'" class="space-y-3">
                <input v-model="newBooking.name" placeholder="é£¯åº—åç¨±" class="w-full bg-bg p-3 rounded-xl outline-none focus:border-primary border-2 border-transparent">
                <input v-model="newBooking.address" placeholder="åœ°å€ (æ”¯æ´ Google Maps)" class="w-full bg-bg p-3 rounded-xl outline-none">
                <div class="flex gap-2">
                    <input type="text" v-model="newBooking.checkIn" placeholder="Check-in" class="w-1/2 bg-bg p-3 rounded-xl outline-none">
                    <input type="text" v-model="newBooking.checkOut" placeholder="Check-out" class="w-1/2 bg-bg p-3 rounded-xl outline-none">
                </div>
                <div class="text-right text-xs text-gray-400">* é»æ“Šç…§ç‰‡å¯å–®ç¨æ›´æ›</div>
            </div>

            <div v-else class="space-y-3">
                <div class="flex gap-2">
                    <input v-model="newBooking.from" placeholder="å‡ºç™¼ (TPE)" class="w-1/2 bg-bg p-3 rounded-xl outline-none uppercase">
                    <input v-model="newBooking.to" placeholder="æŠµé” (NRT)" class="w-1/2 bg-bg p-3 rounded-xl outline-none uppercase">
                </div>
                <div class="flex gap-2">
                    <input type="time" v-model="newBooking.depTime" class="w-1/2 bg-bg p-3 rounded-xl outline-none">
                    <input type="time" v-model="newBooking.arrTime" class="w-1/2 bg-bg p-3 rounded-xl outline-none">
                </div>
                <input v-model="newBooking.code" placeholder="èˆªç­ (BR198)" class="w-full bg-bg p-3 rounded-xl outline-none uppercase">
                <input v-model="newBooking.date" placeholder="æ—¥æœŸ (01 JAN)" class="w-full bg-bg p-3 rounded-xl outline-none">
            </div>

            <div class="flex gap-2 mt-4">
                <button v-if="editingBookingId" @click="deleteBookingFromModal" class="w-1/3 bg-red-100 text-red-500 py-3 rounded-xl font-bold hover:bg-red-200 transition-colors">åˆªé™¤</button>
                <button @click="saveBooking" :class="[editingBookingId ? 'w-2/3' : 'w-full', 'bg-primary text-white py-3 rounded-xl font-bold shadow-soft hover:bg-red-400 transition-colors']">
                    {{ editingBookingId ? 'å„²å­˜ä¿®æ”¹' : 'å„²å­˜é è¨‚' }}
                </button>
            </div>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" @click.self="showExpenseModal = false">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <h3 class="text-xl font-bold mb-4">{{ editingExpenseId ? 'ä¿®æ”¹è¨˜å¸³' : 'æ–°å¢è¨˜å¸³' }}</h3>
            <div class="space-y-4">
                <input v-model="newExpense.title" placeholder="é …ç›®åç¨±" class="w-full bg-bg p-3 rounded-xl outline-none">
                <div class="relative">
                    <span class="absolute left-4 top-3 text-gray-500 font-bold">Â¥</span>
                    <input type="number" inputmode="numeric" pattern="[0-9]*" v-model.number="newExpense.amount" placeholder="é‡‘é¡ (æ—¥å¹£)" class="w-full bg-bg p-3 pl-10 rounded-xl outline-none font-mono text-lg">
                </div>
                <select v-model="newExpense.category" class="w-full bg-bg p-3 rounded-xl outline-none">
                    <option value="food">ğŸ± é¤é£²</option>
                    <option value="transport">ğŸš† äº¤é€š</option>
                    <option value="shop">ğŸ›ï¸ è³¼ç‰©</option>
                    <option value="ticket">ğŸ« ç¥¨åˆ¸</option>
                </select>
                <button @click="saveExpense" class="w-full bg-accent text-text py-3 rounded-xl font-bold shadow-soft">{{ editingExpenseId ? 'å„²å­˜ä¿®æ”¹' : 'è¨˜ä¸€ç­†' }}</button>
            </div>
        </div>
    </div>

    <div v-if="showTodoModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" @click.self="showTodoModal = false">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <h3 class="text-xl font-bold mb-4">{{ editingTodoId ? 'ä¿®æ”¹å¾…è¾¦' : 'æ–°å¢å¾…è¾¦' }}</h3>
            <div class="space-y-4">
                <input v-model="newTodo.text" placeholder="å¾…è¾¦äº‹é …å…§å®¹" class="w-full bg-bg p-3 rounded-xl outline-none">
                <div class="flex gap-2">
                    <button v-if="editingTodoId" @click="deleteTodo" class="w-1/3 bg-red-100 text-red-500 py-3 rounded-xl font-bold">åˆªé™¤</button>
                    <button @click="saveTodo" :class="[editingTodoId ? 'w-2/3' : 'w-full', 'bg-primary text-white py-3 rounded-xl font-bold shadow-soft']">ç¢ºèª</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showShoppingModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" @click.self="showShoppingModal = false">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up pb-8">
            <h3 class="text-xl font-bold mb-4">æ–°å¢è³¼ç‰©æ¸…å–®</h3>
            <div class="space-y-4">
                <input v-model="newShoppingItem.name" placeholder="å•†å“åç¨±" class="w-full bg-bg p-3 rounded-xl outline-none">
                <div class="photo-upload-box h-32 rounded-xl flex flex-col items-center justify-center cursor-pointer bg-gray-50" @click="triggerShoppingUpload">
                    <img v-if="newShoppingItem.img" :src="newShoppingItem.img" class="h-full w-full object-contain">
                    <div v-else class="text-gray-400 text-center">
                        <i class="fa-solid fa-camera text-2xl mb-2"></i>
                        <p class="text-xs">é»æ“Šä¸Šå‚³åœ–ç‰‡</p>
                    </div>
                </div>
                <input type="file" id="shoppingFile" class="hidden" accept="image/*" @change="handleShoppingPhoto">
                <button @click="addShoppingItem" class="w-full bg-primary text-white py-3 rounded-xl font-bold shadow-soft">åŠ å…¥æ¸…å–®</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            // --- Basic Data ---
            const currentTab = ref('schedule');
            const selectedDayIndex = ref(0);
            
            // Modals State
            const showAddModal = ref(false);
            const showBookingModal = ref(false);
            const showExpenseModal = ref(false);
            const showShoppingModal = ref(false);
            const showTodoModal = ref(false);

            const bookingType = ref('hotel');
            // ä¿®æ”¹é»: ä½¿ç”¨ images è³‡æ–™å¤¾åœ–ç‰‡
            const headerImage = ref('images/f1cat.jpg'); 
            
            const weatherData = ref({ temp: '--', icon: 'fa-solid fa-spinner fa-spin', desc: 'Loading...' });

            const tabs = [
                { id: 'schedule', name: 'è¡Œç¨‹', icon: 'fa-regular fa-calendar-days' },
                { id: 'bookings', name: 'ä½å®¿', icon: 'fa-solid fa-hotel' },
                { id: 'expense', name: 'è¨˜å¸³', icon: 'fa-solid fa-yen-sign' },
                { id: 'planning', name: 'æº–å‚™', icon: 'fa-solid fa-list-check' },
            ];

            // 01/03 (Sat) - 01/11 (Sun)
            const scheduleDays = [
                { date: '03', weekday: 'SAT' }, { date: '04', weekday: 'SUN' },
                { date: '05', weekday: 'MON' }, { date: '06', weekday: 'TUE' },
                { date: '07', weekday: 'WED' }, { date: '08', weekday: 'THU' },
                { date: '09', weekday: 'FRI' }, { date: '10', weekday: 'SAT' },
                { date: '11', weekday: 'SUN' },
            ];

            // --- Events Data (Sample) ---
            const events = ref({
                0: [
                    { id: 1, title: 'TPE -> NRT', category: 'flight', time: '08:50', location: 'æ¡ƒåœ’ T2', subTitle: 'BR198', transportType: 'flight', transportTime:'-', offsetX: 0, photo: null },
                    { id: 2, title: 'Check-in é£¯åº—', category: 'hotel', time: '14:30', location: 'Sotetsu Fresa Inn Daimon', transportType: 'train', transportTime:'50 min', offsetX: 0, photo: null },
                ]
            });

            // --- Bookings Data (Updated Images) ---
            const bookings = ref({
                flights: [
                    { id: 1, from: 'TPE', to: 'NRT', code: 'BR198', date: '01/03', depTime: '08:50', arrTime: '12:55' },
                    { id: 2, from: 'HND', to: 'TSA', code: 'BR191', date: '01/11', depTime: '12:40', arrTime: '15:05' }
                ],
                hotels: [
                    { 
                        id: 1, 
                        name: 'Sotetsu Fresa Innå¤§é–€ç«™', 
                        address: 'Sotetsu Fresa Inn Daimon', 
                        checkIn: '01/03', 
                        checkOut: '01/05', 
                        nights: 2, 
                        img: 'images/hotel01.jpg' // ä¿®æ”¹é»: ä½¿ç”¨æœ¬åœ°åœ–ç‰‡
                    },
                    { 
                        id: 2, 
                        name: 'æ±äº¬è¿ªå£«å°¼æµ·æ´‹å¤¢å¹»æ³‰é„‰å¤§é£¯åº—', 
                        address: 'Tokyo DisneySea Fantasy Springs Hotel', 
                        checkIn: '01/05', 
                        checkOut: '01/07', 
                        nights: 2, 
                        img: 'images/hotel02.jpg' // ä¿®æ”¹é»: ä½¿ç”¨æœ¬åœ°åœ–ç‰‡
                    },
                    { 
                        id: 3, 
                        name: 'Hotel Okura Tokyo Bay', 
                        address: 'Hotel Okura Tokyo Bay', 
                        checkIn: '01/07', 
                        checkOut: '01/09', 
                        nights: 2, 
                        img: 'images/hotel03.jpg' // ä¿®æ”¹é»: ä½¿ç”¨æœ¬åœ°åœ–ç‰‡
                    },
                    { 
                        id: 4, 
                        name: 'The Gate Hotel Kaminarimon', 
                        address: 'The Gate Hotel Kaminarimon by Hulic', 
                        checkIn: '01/09', 
                        checkOut: '01/11', 
                        nights: 2, 
                        img: 'images/hotel04.jpg' // ä¿®æ”¹é»: ä½¿ç”¨æœ¬åœ°åœ–ç‰‡
                    }
                ]
            });

            const expenses = ref([
                { id: 1, title: 'Suica å„²å€¼', amount: 5000, category: 'transport', date: '01/03', offsetX: 0 },
            ]);

            const todos = ref([
                { id: 1, text: 'è³¼è²·æ—…éŠä¿éšª', done: true },
                { id: 2, text: 'é–€ç¥¨ç¢ºèª', done: false }
            ]);

            const shoppingList = ref([
                { id: 1, name: 'æ±äº¬é™å®šä¼´æ‰‹ç¦®', img: null },
            ]);

            // --- Temp Models ---
            const newEvent = ref({ title: '', category: 'spot', time: '10:00', location: '', openTime: '' });
            const newBooking = ref({ name: '', address: '', checkIn: '', checkOut: '', from: '', to: '', code: '', date: '', depTime: '10:00', arrTime: '14:00' });
            const newExpense = ref({ title: '', amount: '', category: 'food' });
            const newShoppingItem = ref({ name: '', img: null });
            const newTodo = ref({ text: '' });
            
            // Editing States
            const editingEventId = ref(null);
            const editingExpenseId = ref(null);
            const editingTodoId = ref(null);
            const editingBookingId = ref(null);

            // --- Computed ---
            const currentDayEvents = computed(() => events.value[selectedDayIndex.value] || []);
            const totalExpenseJpy = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
            const totalExpense = computed(() => Math.round(totalExpenseJpy.value * 0.22));

            // --- Swipe Logic (Unified) ---
            let startX = 0;
            const isSwiping = ref(false);

            const touchStart = (e, item) => {
                startX = e.touches[0].clientX;
                isSwiping.value = true;
            };

            const touchMove = (e, item) => {
                const currentX = e.touches[0].clientX;
                const diff = currentX - startX;
                if (diff < 0) {
                     if (diff > -100) item.offsetX = diff;
                } 
                else if (diff > 0) {
                    if (item.offsetX < 0) {
                         item.offsetX = -80 + diff;
                         if (item.offsetX > 0) item.offsetX = 0;
                    }
                }
            };

            const touchEnd = (e, item) => {
                isSwiping.value = false;
                if (item.offsetX < -40) item.offsetX = -80; // Snap Open
                else item.offsetX = 0;   // Snap Close
            };

            const resetSwipes = (currentItem) => {
                if (currentItem && currentItem.offsetX === -80) currentItem.offsetX = 0;
            };

            // --- Methods ---
            
            // 0. Weather
            const fetchWeather = async () => {
                try {
                    const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.6895&longitude=139.6917&current_weather=true');
                    const data = await res.json();
                    const code = data.current_weather.weathercode;
                    const temp = Math.round(data.current_weather.temperature);
                    let icon = 'fa-solid fa-cloud'; let desc = 'å¤šé›²';
                    if(code <= 1) { icon = 'fa-solid fa-sun'; desc = 'æ™´å¤©'; }
                    else if(code <= 3) { icon = 'fa-solid fa-cloud-sun'; desc = 'å¤šé›²'; }
                    else if(code <= 60) { icon = 'fa-solid fa-cloud-rain'; desc = 'æœ‰é›¨'; }
                    else { icon = 'fa-solid fa-snowflake'; desc = 'ä¸‹é›ª/é›·é›¨'; }
                    weatherData.value = { temp, icon, desc };
                } catch (e) { weatherData.value = { temp: '12', icon: 'fa-solid fa-cloud', desc: 'é›¢ç·šé¡¯ç¤º' }; }
            };

            // 1. Schedule Actions
            const recalculateTransport = (dayIndex) => {
                if (!events.value[dayIndex]) return;
                events.value[dayIndex].sort((a,b) => a.time.localeCompare(b.time));
                events.value[dayIndex].forEach((evt, idx) => {
                    if(idx === 0) {
                        evt.transportType = 'flight'; evt.transportTime = '';
                    } else {
                        const isWalk = Math.random() > 0.5;
                        evt.transportType = isWalk ? 'walk' : 'train';
                        evt.transportTime = Math.floor(Math.random() * 25 + 5) + ' min';
                    }
                });
            };

            const openEventModal = (item = null) => {
                if (item) {
                    editingEventId.value = item.id;
                    newEvent.value = { ...item };
                } else {
                    editingEventId.value = null;
                    newEvent.value = { title: '', category: 'spot', time: '10:00', location: '', openTime: '' };
                }
                showAddModal.value = true;
            };

            const handleEventClick = (item) => {
                if (item.offsetX === -80) item.offsetX = 0;
                else openEventModal(item);
            };

            const saveEvent = () => {
                if(!events.value[selectedDayIndex.value]) events.value[selectedDayIndex.value] = [];
                const currentList = events.value[selectedDayIndex.value];

                if (editingEventId.value) {
                    const index = currentList.findIndex(e => e.id === editingEventId.value);
                    if (index !== -1) currentList[index] = { ...currentList[index], ...newEvent.value };
                } else {
                    currentList.push({ id: Date.now(), ...newEvent.value, transportType: 'walk', transportTime: '10 min', offsetX: 0, photo: null });
                }
                showAddModal.value = false;
                recalculateTransport(selectedDayIndex.value);
            };

            const deleteEvent = (index) => {
                if(confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) {
                    events.value[selectedDayIndex.value].splice(index, 1);
                    recalculateTransport(selectedDayIndex.value);
                } else events.value[selectedDayIndex.value][index].offsetX = 0;
            };
            
            const deleteEventInModal = () => {
                 if(confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) {
                    const currentList = events.value[selectedDayIndex.value];
                    const index = currentList.findIndex(e => e.id === editingEventId.value);
                    if (index !== -1) {
                         currentList.splice(index, 1);
                         recalculateTransport(selectedDayIndex.value);
                    }
                    showAddModal.value = false;
                }
            }

            // 2. Booking Actions (NEW: Edit/Delete Logic)
            const openBookingModal = (item = null, type = 'hotel') => {
                bookingType.value = type;
                if (item) {
                    editingBookingId.value = item.id;
                    if(type === 'hotel') {
                        newBooking.value = { ...item }; // Copy hotel data
                    } else {
                        newBooking.value = { ...item }; // Copy flight data
                    }
                } else {
                    editingBookingId.value = null;
                    newBooking.value = { name: '', address: '', checkIn: '', checkOut: '', from: '', to: '', code: '', date: '', depTime: '10:00', arrTime: '14:00' };
                }
                showBookingModal.value = true;
            };

            const saveBooking = () => {
                const targetList = bookingType.value === 'hotel' ? bookings.value.hotels : bookings.value.flights;
                
                if (editingBookingId.value) {
                    // Update existing
                    const index = targetList.findIndex(b => b.id === editingBookingId.value);
                    if (index !== -1) {
                         // Preserve the original image if not updated, or keep existing properties
                         targetList[index] = { ...targetList[index], ...newBooking.value };
                    }
                } else {
                    // Add new
                    if(bookingType.value === 'hotel') {
                        targetList.push({
                            id: Date.now(), 
                            name: newBooking.value.name, address: newBooking.value.address,
                            checkIn: newBooking.value.checkIn, checkOut: newBooking.value.checkOut, 
                            nights: 1, img: 'https://placehold.co/600x400/E0E5D5/5A544B?text=New+Hotel'
                        });
                    } else {
                        targetList.push({
                            id: Date.now(), 
                            from: newBooking.value.from, to: newBooking.value.to,
                            code: newBooking.value.code, date: newBooking.value.date, 
                            depTime: newBooking.value.depTime, arrTime: newBooking.value.arrTime
                        });
                    }
                }
                showBookingModal.value = false;
            };

            const deleteBookingFromModal = () => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†é è¨‚å—ï¼Ÿ')) {
                    const targetList = bookingType.value === 'hotel' ? bookings.value.hotels : bookings.value.flights;
                    const index = targetList.findIndex(b => b.id === editingBookingId.value);
                    if (index !== -1) targetList.splice(index, 1);
                    showBookingModal.value = false;
                }
            };

            // 3. Expense Actions
            const openExpenseModal = (item = null) => {
                if (item) {
                    editingExpenseId.value = item.id;
                    newExpense.value = { title: item.title, amount: item.amount, category: item.category };
                } else {
                    editingExpenseId.value = null;
                    newExpense.value = { title: '', amount: '', category: 'food' };
                }
                showExpenseModal.value = true;
            };
            const handleExpenseClick = (item) => {
                if (item.offsetX === -80) item.offsetX = 0;
                else openExpenseModal(item);
            };
            const saveExpense = () => {
                if (editingExpenseId.value) {
                    const index = expenses.value.findIndex(e => e.id === editingExpenseId.value);
                    if (index !== -1) expenses.value[index] = { ...expenses.value[index], ...newExpense.value };
                } else {
                    expenses.value.unshift({
                        id: Date.now(), title: newExpense.value.title || 'ä¸€èˆ¬æ”¯å‡º', 
                        amount: Number(newExpense.value.amount) || 0, category: newExpense.value.category,
                        date: new Date().toLocaleDateString('en-US', {month:'2-digit', day:'2-digit'}), offsetX: 0
                    });
                }
                showExpenseModal.value = false;
            };
            const deleteExpense = (index) => {
                if(confirm('åˆªé™¤æ­¤ç­†è¨˜å¸³ï¼Ÿ')) expenses.value.splice(index, 1);
                else expenses.value[index].offsetX = 0;
            };

            // 4. Todo Actions
            const openTodoModal = (item = null) => {
                if (item) {
                    editingTodoId.value = item.id;
                    newTodo.value = { text: item.text };
                } else {
                    editingTodoId.value = null;
                    newTodo.value = { text: '' };
                }
                showTodoModal.value = true;
            };
            const saveTodo = () => {
                if (editingTodoId.value) {
                    const todo = todos.value.find(t => t.id === editingTodoId.value);
                    if (todo) todo.text = newTodo.value.text;
                } else {
                    if (newTodo.value.text) todos.value.push({ id: Date.now(), text: newTodo.value.text, done: false });
                }
                showTodoModal.value = false;
            };
            const deleteTodo = () => {
                if(confirm('ç¢ºå®šåˆªé™¤æ­¤å¾…è¾¦äº‹é …ï¼Ÿ')) {
                    todos.value = todos.value.filter(t => t.id !== editingTodoId.value);
                    showTodoModal.value = false;
                }
            };

            // 5. Shopping Actions
            const triggerShoppingUpload = () => document.getElementById('shoppingFile').click();
            const handleShoppingPhoto = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => newShoppingItem.value.img = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            const addShoppingItem = () => {
                shoppingList.value.push({
                    id: Date.now(), name: newShoppingItem.value.name || 'æœªå‘½å', img: newShoppingItem.value.img
                });
                showShoppingModal.value = false;
                newShoppingItem.value = { name: '', img: null };
            };
            const removeShoppingItem = (id) => {
                if(confirm('åˆªé™¤æ­¤ç‰©å“ï¼Ÿ')) shoppingList.value = shoppingList.value.filter(i => i.id !== id);
            };

            // Common
            const triggerPhotoUpload = (id) => document.getElementById('file-' + id).click();
            const handlePhotoUpload = (e, item) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => item.photo = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            const handleBookingPhoto = (e, item) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => item.img = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            
            // Helpers
            const getCategoryColor = (cat) => ({ flight:'#3B82F6', spot:'#FF8E8E', food:'#F59E0B', hotel:'#8B5CF6', shop:'#10B981' }[cat] || '#9CA3AF');
            const getCategoryIcon = (cat) => ({ transport:'ğŸš†', food:'ğŸ±', shop:'ğŸ›ï¸', ticket:'ğŸ«' }[cat] || 'ğŸ’°');
            const getTransportIcon = (type) => (type === 'walk' ? 'fa-solid fa-person-walking' : 'fa-solid fa-train-subway');
            const openMap = (loc) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank');
            const handleImgError = (e) => {
                // å¦‚æœæ‰¾ä¸åˆ°åœ–ç‰‡ï¼Œæ”¹ç‚ºé¡¯ç¤ºç°è‰²å€å¡Šä¸¦æç¤º
                e.target.src = "https://placehold.co/600x400/E0E5D5/5A544B?text=Image+Not+Found";
            };

            onMounted(() => fetchWeather());

            return {
                currentTab, tabs, scheduleDays, selectedDayIndex, currentDayEvents,
                bookings, expenses, todos, shoppingList,
                totalExpense, totalExpenseJpy, 
                showAddModal, showBookingModal, showExpenseModal, showShoppingModal, showTodoModal,
                bookingType, newEvent, newBooking, newExpense, newShoppingItem, newTodo, headerImage, weatherData, isSwiping,
                editingEventId, editingExpenseId, editingTodoId, editingBookingId,
                openEventModal, saveEvent, deleteEvent, deleteEventInModal, handleEventClick,
                touchStart, touchMove, touchEnd, resetSwipes,
                openBookingModal, saveBooking, deleteBookingFromModal,
                openExpenseModal, saveExpense, deleteExpense, handleExpenseClick,
                openTodoModal, saveTodo, deleteTodo,
                addShoppingItem, removeShoppingItem,
                getCategoryColor, getCategoryIcon, getTransportIcon, openMap, handleImgError,
                triggerPhotoUpload, handlePhotoUpload, handleBookingPhoto, triggerShoppingUpload, handleShoppingPhoto
            };
        }
    }).mount('#app');
</script>
</body>
</html>